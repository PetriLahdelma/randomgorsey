---
phase: 07-visual-effects-foundation
plan: 05
type: execute
wave: 3
depends_on: ["07-02", "07-03", "07-04"]
files_modified:
  - src/stories/effects/VideoBackground.stories.tsx
  - src/stories/effects/HeroImage.stories.tsx
  - src/stories/effects/Scene3D.stories.tsx
  - src/stories/effects/ParticleField.stories.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all effects components in Storybook"
    - "User can toggle performance tier in Storybook controls"
    - "User can see poster fallback behavior in VideoBackground story"
    - "User can adjust particle count and color in ParticleField story"
  artifacts:
    - path: "src/stories/effects/VideoBackground.stories.tsx"
      provides: "VideoBackground Storybook documentation"
      min_lines: 50
    - path: "src/stories/effects/HeroImage.stories.tsx"
      provides: "HeroImage Storybook documentation"
      min_lines: 40
    - path: "src/stories/effects/Scene3D.stories.tsx"
      provides: "Scene3D Storybook documentation"
      min_lines: 40
    - path: "src/stories/effects/ParticleField.stories.tsx"
      provides: "ParticleField Storybook documentation"
      min_lines: 60
  key_links:
    - from: "src/stories/effects/*.stories.tsx"
      to: "src/components/effects/*.tsx"
      via: "imports component"
      pattern: "import.*from.*@/components/effects"
---

<objective>
Create comprehensive Storybook stories for all visual effects components with interactive controls for testing different performance tiers and configurations.

Purpose: Document all effects components with 1:1 Storybook coverage per project constraint.
Output: Four story files covering VideoBackground, HeroImage, Scene3D, and ParticleField.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-visual-effects-foundation/07-RESEARCH.md
@.planning/phases/07-visual-effects-foundation/07-02-SUMMARY.md
@.planning/phases/07-visual-effects-foundation/07-03-SUMMARY.md
@.planning/phases/07-visual-effects-foundation/07-04-SUMMARY.md
@src/components/effects/index.ts
@src/stories/layout/Stack.stories.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoBackground and HeroImage stories</name>
  <files>
    - src/stories/effects/VideoBackground.stories.tsx
    - src/stories/effects/HeroImage.stories.tsx
  </files>
  <action>
1. Create `src/stories/effects/` directory

2. Create `src/stories/effects/VideoBackground.stories.tsx`:

Use StoryObj format with autodocs tag (matching existing story conventions).

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { VideoBackground } from '@/components/effects';

// Use a placeholder video URL and poster for stories
// In real usage, these would be actual assets
const PLACEHOLDER_VIDEO = 'https://www.w3schools.com/html/mov_bbb.mp4';
const PLACEHOLDER_POSTER = 'https://picsum.photos/1920/1080';

const meta: Meta<typeof VideoBackground> = {
  title: 'Effects/VideoBackground',
  component: VideoBackground,
  tags: ['autodocs'],
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        component: 'Full-bleed video background with performance-tiered fallbacks. Shows poster on tier 0, mobile, or reduced motion.',
      },
    },
  },
  argTypes: {
    src: { control: 'text' },
    poster: { control: 'text' },
    overlayOpacity: { control: { type: 'range', min: 0, max: 1, step: 0.1 } },
  },
};

export default meta;
type Story = StoryObj<typeof VideoBackground>;

export const Default: Story = {
  args: {
    src: PLACEHOLDER_VIDEO,
    poster: PLACEHOLDER_POSTER,
  },
};

export const WithOverlay: Story = {
  args: {
    src: PLACEHOLDER_VIDEO,
    poster: PLACEHOLDER_POSTER,
    overlayOpacity: 0.5,
  },
};

export const PosterOnly: Story = {
  name: 'Poster Fallback (simulates tier 0)',
  parameters: {
    docs: {
      description: {
        story: 'On tier 0 devices or with reduced motion, only the poster image is shown.',
      },
    },
  },
  args: {
    src: PLACEHOLDER_VIDEO,
    poster: PLACEHOLDER_POSTER,
  },
};
```

3. Create `src/stories/effects/HeroImage.stories.tsx`:

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { HeroImage } from '@/components/effects';
import { Container } from '@/components/layout';

const PLACEHOLDER_IMAGE = 'https://picsum.photos/1920/1080';

const meta: Meta<typeof HeroImage> = {
  title: 'Effects/HeroImage',
  component: HeroImage,
  tags: ['autodocs'],
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        component: 'Full-bleed responsive hero image using the Bleed component for edge-to-edge display.',
      },
    },
  },
  argTypes: {
    height: {
      control: 'select',
      options: ['half', 'full', 'auto'],
    },
    objectFit: {
      control: 'select',
      options: ['cover', 'contain'],
    },
    objectPosition: { control: 'text' },
    overlayOpacity: { control: { type: 'range', min: 0, max: 1, step: 0.1 } },
    loading: {
      control: 'select',
      options: ['lazy', 'eager'],
    },
  },
};

export default meta;
type Story = StoryObj<typeof HeroImage>;

export const Default: Story = {
  args: {
    src: PLACEHOLDER_IMAGE,
    alt: 'Hero image',
    height: 'half',
  },
};

export const FullHeight: Story = {
  args: {
    src: PLACEHOLDER_IMAGE,
    alt: 'Full height hero',
    height: 'full',
  },
};

export const WithOverlay: Story = {
  args: {
    src: PLACEHOLDER_IMAGE,
    alt: 'Hero with overlay',
    height: 'half',
    overlayOpacity: 0.4,
  },
};

export const InsideContainer: Story = {
  render: (args) => (
    <Container size="lg" className="py-8">
      <p className="mb-4">Content before hero</p>
      <HeroImage {...args} />
      <p className="mt-4">Content after hero (hero breaks out of container)</p>
    </Container>
  ),
  args: {
    src: PLACEHOLDER_IMAGE,
    alt: 'Hero inside container',
    height: 'half',
  },
};
```
  </action>
  <verify>
    - Both story files exist in src/stories/effects/
    - `npx tsc --noEmit src/stories/effects/VideoBackground.stories.tsx` compiles
    - `npx tsc --noEmit src/stories/effects/HeroImage.stories.tsx` compiles
  </verify>
  <done>VideoBackground and HeroImage have Storybook stories with interactive controls</done>
</task>

<task type="auto">
  <name>Task 2: Create Scene3D and ParticleField stories</name>
  <files>
    - src/stories/effects/Scene3D.stories.tsx
    - src/stories/effects/ParticleField.stories.tsx
  </files>
  <action>
1. Create `src/stories/effects/Scene3D.stories.tsx`:

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { Scene3D } from '@/components/effects';

const meta: Meta<typeof Scene3D> = {
  title: 'Effects/Scene3D',
  component: Scene3D,
  tags: ['autodocs'],
  parameters: {
    docs: {
      description: {
        component: 'React Three Fiber Canvas wrapper with automatic performance scaling. Returns null on tier 0 or devices without WebGL support.',
      },
    },
  },
  argTypes: {
    overlay: { control: 'boolean' },
    dpr: { control: { type: 'range', min: 0.5, max: 2, step: 0.5 } },
  },
};

export default meta;
type Story = StoryObj<typeof Scene3D>;

// Simple rotating cube as demo content
const DemoBox = () => {
  return (
    <mesh>
      <boxGeometry args={[1, 1, 1]} />
      <meshStandardMaterial color="hotpink" />
    </mesh>
  );
};

export const Default: Story = {
  render: (args) => (
    <div className="h-[400px] w-full bg-gray-900">
      <Scene3D {...args}>
        <ambientLight intensity={0.5} />
        <pointLight position={[10, 10, 10]} />
        <DemoBox />
      </Scene3D>
    </div>
  ),
  args: {
    overlay: false,
  },
};

export const AsOverlay: Story = {
  render: (args) => (
    <div className="relative h-[400px] w-full">
      <div className="flex h-full items-center justify-center bg-gray-800">
        <h2 className="text-4xl font-bold text-white">Content with 3D overlay</h2>
      </div>
      <Scene3D {...args}>
        <ambientLight intensity={0.5} />
        <pointLight position={[10, 10, 10]} />
        <DemoBox />
      </Scene3D>
    </div>
  ),
  args: {
    overlay: true,
  },
};
```

2. Create `src/stories/effects/ParticleField.stories.tsx`:

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { Scene3D, ParticleField } from '@/components/effects';

const meta: Meta<typeof ParticleField> = {
  title: 'Effects/ParticleField',
  component: ParticleField,
  tags: ['autodocs'],
  parameters: {
    docs: {
      description: {
        component: 'GPU-instanced particle system that scales particle count based on device tier. Tier 1: 25%, Tier 2: 50%, Tier 3: 100% of specified count.',
      },
    },
  },
  argTypes: {
    count: { control: { type: 'range', min: 100, max: 2000, step: 100 } },
    color: { control: 'color' },
    spread: { control: { type: 'range', min: 5, max: 20, step: 1 } },
    size: { control: { type: 'range', min: 0.01, max: 0.2, step: 0.01 } },
  },
  decorators: [
    (Story) => (
      <div className="h-[500px] w-full bg-black">
        <Scene3D>
          <ambientLight intensity={0.2} />
          <Story />
        </Scene3D>
      </div>
    ),
  ],
};

export default meta;
type Story = StoryObj<typeof ParticleField>;

export const Default: Story = {
  args: {
    count: 1000,
    color: '#ffffff',
    spread: 10,
    size: 0.05,
  },
};

export const HighDensity: Story = {
  args: {
    count: 2000,
    color: '#ffffff',
    spread: 8,
    size: 0.03,
  },
};

export const ColoredParticles: Story = {
  args: {
    count: 1000,
    color: '#ffd600',
    spread: 10,
    size: 0.05,
  },
};

export const LargeParticles: Story = {
  args: {
    count: 500,
    color: '#00ff88',
    spread: 12,
    size: 0.1,
  },
};

export const PerformanceTiers: Story = {
  parameters: {
    docs: {
      description: {
        story: 'Same count (1000) renders as: Tier 1 = 250 particles, Tier 2 = 500 particles, Tier 3 = 1000 particles. Check your device tier in browser console.',
      },
    },
  },
  args: {
    count: 1000,
    color: '#ffffff',
    spread: 10,
    size: 0.05,
  },
};
```
  </action>
  <verify>
    - Both story files exist in src/stories/effects/
    - `npm run storybook` starts without errors (or `npm run build` passes if no storybook command)
    - Stories render in Storybook
  </verify>
  <done>Scene3D and ParticleField have Storybook stories with interactive controls</done>
</task>

<task type="auto">
  <name>Task 3: Verify Storybook builds</name>
  <files>None (verification only)</files>
  <action>
1. Run Storybook build to verify all stories compile:
   ```bash
   npm run build-storybook
   ```

   Or if that command doesn't exist, verify TypeScript compilation:
   ```bash
   npx tsc --noEmit
   ```

2. Optionally start Storybook dev server to visually verify:
   ```bash
   npm run storybook
   ```

3. Navigate to Effects category and verify all four components have stories.
  </action>
  <verify>
    - Storybook build completes without errors
    - All four effect component stories are accessible in Storybook
  </verify>
  <done>All effects components have documented Storybook stories</done>
</task>

</tasks>

<verification>
1. Run `npm run build-storybook` or `npx tsc --noEmit` - should complete without errors
2. Start Storybook and verify Effects category shows all four components
3. Interactive controls work for adjusting props
</verification>

<success_criteria>
- All 4 effects components have Storybook stories
- Stories use StoryObj format with autodocs tag
- VideoBackground story demonstrates poster fallback
- HeroImage story shows container breakout behavior
- Scene3D story shows basic R3F usage
- ParticleField story has interactive count/color/size controls
- Storybook builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-visual-effects-foundation/07-05-SUMMARY.md`
</output>
