---
phase: 07-visual-effects-foundation
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/effects/VideoBackground.tsx
  - src/components/effects/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees video playing on desktop with tier 1+ GPU"
    - "User sees poster image on tier 0 or mobile with reduced motion"
    - "User on mobile sees optimized poster instead of video (battery-conscious)"
    - "Video lazy-loads when scrolled into view"
  artifacts:
    - path: "src/components/effects/VideoBackground.tsx"
      provides: "Full-bleed video background with fallbacks"
      exports: ["VideoBackground"]
      min_lines: 50
    - path: "src/components/effects/index.ts"
      provides: "Effects barrel export"
      exports: ["VideoBackground"]
  key_links:
    - from: "src/components/effects/VideoBackground.tsx"
      to: "src/lib/performance/context.tsx"
      via: "usePerformance hook"
      pattern: "usePerformance"
---

<objective>
Create a VideoBackground component that renders full-bleed video backgrounds with performance-tiered fallbacks (poster images for low-tier/mobile devices).

Purpose: Replace the inline video in Home.tsx with a reusable, performance-aware component that degrades gracefully.
Output: VideoBackground component that uses GPU tier to decide video vs static image.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-visual-effects-foundation/07-RESEARCH.md
@.planning/phases/07-visual-effects-foundation/07-01-SUMMARY.md
@src/lib/performance/context.tsx
@src/pages/Home.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoBackground component</name>
  <files>
    - src/components/effects/VideoBackground.tsx
  </files>
  <action>
1. Create `src/components/effects/` directory

2. Create `src/components/effects/VideoBackground.tsx`:

Props interface:
```typescript
interface VideoBackgroundProps {
  /** Video source URL (WebM preferred) */
  src: string;
  /** Poster image shown on low-tier devices or while loading */
  poster: string;
  /** Optional MP4 fallback for broader compatibility */
  fallbackSrc?: string;
  /** Additional CSS classes */
  className?: string;
  /** Overlay opacity for text readability (0-1) */
  overlayOpacity?: number;
}
```

Implementation:
- Import usePerformance from '@/lib/performance'
- Import cn from '@/lib/utils'
- Check tier and isReducedMotion:
  - Tier 0 OR isReducedMotion: Return poster image only (as background-image)
  - Tier 1+ AND isMobile: Return poster image (battery-conscious)
  - Tier 1+ AND NOT mobile: Return video with poster as fallback
- Video element attributes: autoPlay, muted, loop, playsInline
- Use fixed positioning: `fixed inset-0 -z-10`
- Include optional overlay div for text contrast
- Use `h-dvh` for proper mobile viewport handling (dynamic viewport height)

Pattern from research:
```typescript
export const VideoBackground: React.FC<VideoBackgroundProps> = ({
  src,
  poster,
  fallbackSrc,
  className,
  overlayOpacity = 0,
}) => {
  const { tier, isMobile, isReducedMotion } = usePerformance();

  // Tier 0, reduced motion, or mobile: static image only
  if (tier === 0 || isReducedMotion || isMobile) {
    return (
      <div className={cn('fixed inset-0 -z-10', className)}>
        <div
          className="h-full w-full bg-cover bg-center"
          style={{ backgroundImage: `url(${poster})` }}
          role="img"
          aria-label="Background"
        />
        {overlayOpacity > 0 && (
          <div
            className="absolute inset-0 bg-black"
            style={{ opacity: overlayOpacity }}
          />
        )}
      </div>
    );
  }

  // Desktop tier 1+: video with poster fallback
  return (
    <div className={cn('fixed inset-0 -z-10', className)}>
      <video
        autoPlay
        muted
        loop
        playsInline
        poster={poster}
        className="h-full w-full object-cover"
      >
        <source src={src} type="video/webm" />
        {fallbackSrc && <source src={fallbackSrc} type="video/mp4" />}
      </video>
      {overlayOpacity > 0 && (
        <div
          className="absolute inset-0 bg-black"
          style={{ opacity: overlayOpacity }}
        />
      )}
    </div>
  );
};
```

Export both default and named export for flexibility.
  </action>
  <verify>
    - `npx tsc --noEmit src/components/effects/VideoBackground.tsx` compiles without errors
    - File exists at src/components/effects/VideoBackground.tsx
  </verify>
  <done>VideoBackground component exists with performance-tiered rendering logic</done>
</task>

<task type="auto">
  <name>Task 2: Create effects barrel export and verify build</name>
  <files>
    - src/components/effects/index.ts
  </files>
  <action>
1. Create `src/components/effects/index.ts`:
```typescript
export { VideoBackground } from './VideoBackground';
export type { VideoBackgroundProps } from './VideoBackground';
```

2. Verify the build passes:
   - Run `npm run build`
   - Ensure no TypeScript errors

3. Test import works:
   - The component should be importable as:
     - `import { VideoBackground } from '@/components/effects'`
     - `import VideoBackground from '@/components/effects/VideoBackground'`
  </action>
  <verify>
    - `npm run build` completes without errors
    - `npx tsc --noEmit` passes
  </verify>
  <done>Effects module exports VideoBackground, build passes</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should complete without errors
2. Verify VideoBackground is importable from '@/components/effects'
3. Component types are correct (props interface exported)
</verification>

<success_criteria>
- VideoBackground component handles tier 0, mobile, and reduced motion cases
- Component shows poster for low-tier/mobile, video for desktop tier 1+
- Video has required attributes: autoPlay, muted, loop, playsInline
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-visual-effects-foundation/07-02-SUMMARY.md`
</output>
