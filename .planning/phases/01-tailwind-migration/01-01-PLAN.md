---
phase: 01-tailwind-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - index.html
  - src/main.tsx
  - tsconfig.json
  - tsconfig.node.json
  - .env
  - .env.example
autonomous: true

must_haves:
  truths:
    - "Developer can run `npm run dev` and see the app at localhost:3000"
    - "Developer can run `npm run build` and get production output in build/"
    - "All existing React components render without errors"
  artifacts:
    - path: "vite.config.ts"
      provides: "Vite build configuration"
      exports: ["default"]
    - path: "index.html"
      provides: "Vite entry HTML at root"
      contains: "type=\"module\""
    - path: "src/main.tsx"
      provides: "React app entry point"
      contains: "createRoot"
    - path: "tsconfig.json"
      provides: "TypeScript configuration for Vite"
      contains: "vite"
    - path: "tsconfig.node.json"
      provides: "TypeScript config for Vite config file"
      contains: "vite.config.ts"
  key_links:
    - from: "index.html"
      to: "src/main.tsx"
      via: "script type=module"
      pattern: "src=\"/src/main.tsx\""
    - from: "vite.config.ts"
      to: "@vitejs/plugin-react"
      via: "plugin import"
      pattern: "import react from"
---

<objective>
Migrate build system from Create React App to Vite

Purpose: CRA is incompatible with Tailwind CSS v4. Vite provides 10x faster builds and first-class Tailwind v4 support. This is the critical foundation for the entire migration.

Output: Working Vite-based development and production builds with identical behavior to current CRA setup.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-tailwind-migration/01-RESEARCH.md

# Current config files to understand existing setup
@package.json
@tsconfig.json
@public/index.html
@src/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vite and configure build system</name>
  <files>
    package.json
    vite.config.ts
    tsconfig.json
    tsconfig.node.json
  </files>
  <action>
1. Install Vite dependencies:
   ```bash
   npm install vite @vitejs/plugin-react vite-tsconfig-paths vite-plugin-svgr --save-dev
   ```

2. Create vite.config.ts at project root:
   ```typescript
   import path from "path"
   import react from "@vitejs/plugin-react"
   import tsconfigPaths from "vite-tsconfig-paths"
   import svgr from "vite-plugin-svgr"
   import { defineConfig } from "vite"

   export default defineConfig({
     plugins: [
       react(),
       tsconfigPaths(),
       svgr(),
     ],
     resolve: {
       alias: {
         "@": path.resolve(__dirname, "./src"),
       },
     },
     server: {
       port: 3000,
       open: true,
     },
     build: {
       outDir: "build",  // Match CRA output for gh-pages compatibility
       sourcemap: true,
     },
     publicDir: "public",
   })
   ```

3. Update tsconfig.json for Vite compatibility:
   - Keep existing settings
   - Add "types": ["vite/client"] to compilerOptions
   - Ensure "moduleResolution": "bundler" is set
   - Add baseUrl and paths for @ alias

4. Create tsconfig.node.json for vite.config.ts:
   ```json
   {
     "compilerOptions": {
       "composite": true,
       "skipLibCheck": true,
       "module": "ESNext",
       "moduleResolution": "bundler",
       "allowSyntheticDefaultImports": true,
       "strict": true
     },
     "include": ["vite.config.ts"]
   }
   ```

5. Update package.json scripts:
   - "dev": "vite"
   - "build": "vite build"
   - "preview": "vite preview"
   - Keep "start" as alias to "dev" for familiarity
   - Remove react-scripts from dependencies (but keep for now until fully verified)
  </action>
  <verify>
   - vite.config.ts exists and is valid TypeScript
   - tsconfig.json includes vite/client types
   - tsconfig.node.json exists
   - `npm run dev` starts Vite server (will fail until Task 2 completes)
  </verify>
  <done>Vite configuration files created, package.json scripts updated</done>
</task>

<task type="auto">
  <name>Task 2: Migrate entry points and environment variables</name>
  <files>
    index.html
    src/main.tsx
    src/index.tsx
    .env
    .env.example
    src/vite-env.d.ts
  </files>
  <action>
1. Move public/index.html to project root and modify for Vite:
   - Remove %PUBLIC_URL% references (Vite handles this automatically)
   - Add script tag before closing body: `<script type="module" src="/src/main.tsx"></script>`
   - Keep all meta tags, analytics scripts, etc.

2. Rename src/index.tsx to src/main.tsx (Vite convention):
   - Update imports if needed
   - Content stays the same

3. Create src/vite-env.d.ts:
   ```typescript
   /// <reference types="vite/client" />

   interface ImportMetaEnv {
     readonly VITE_EMAILJS_SERVICE_ID: string
     readonly VITE_EMAILJS_TEMPLATE_ID: string
     readonly VITE_EMAILJS_PUBLIC_KEY: string
   }

   interface ImportMeta {
     readonly env: ImportMetaEnv
   }
   ```

4. Create .env.example documenting required variables (if any REACT_APP_ vars exist):
   - Map REACT_APP_* to VITE_* naming convention
   - Example: REACT_APP_API_KEY becomes VITE_API_KEY

5. Update any code using process.env.REACT_APP_* to import.meta.env.VITE_*:
   - Search codebase for "process.env.REACT_APP"
   - Replace with import.meta.env.VITE_*

NOTE: Do NOT delete public/index.html yet - keep it until we verify Vite works.
  </action>
  <verify>
   - index.html exists at project root with module script tag
   - src/main.tsx exists and renders React app
   - src/vite-env.d.ts exists with type declarations
   - `npm run dev` starts successfully and shows the app at localhost:3000
   - `npm run build` produces output in build/ directory
   - No console errors in browser
  </verify>
  <done>Entry points migrated, Vite development server runs, production build succeeds</done>
</task>

<task type="auto">
  <name>Task 3: Verify and clean up CRA artifacts</name>
  <files>
    package.json
    public/index.html (delete)
    src/react-app-env.d.ts (delete)
  </files>
  <action>
1. Verify the migration is complete:
   - Run `npm run dev` and navigate through all routes
   - Run `npm run build` and verify build/ output
   - Run `npm run preview` to test production build locally

2. If everything works, clean up CRA artifacts:
   - Delete public/index.html (now at root)
   - Delete src/react-app-env.d.ts (replaced by vite-env.d.ts)
   - Remove react-scripts from devDependencies in package.json
   - Remove @storybook/preset-create-react-app from devDependencies (will update Storybook in Plan 07)

3. Update package.json:
   - Remove "eject" script
   - Remove "test" script that uses react-scripts (tests need separate config - defer to later)
   - Keep browserslist for now (Vite ignores it but doesn't hurt)

4. Keep react-snap config in package.json for now - will address Vite compatibility in Plan 07

5. Commit changes:
   ```bash
   git add -A
   git commit -m "build(01-01): migrate from CRA to Vite

   - Add vite.config.ts with React plugin
   - Move index.html to root with module script
   - Rename index.tsx to main.tsx
   - Add vite-env.d.ts for environment types
   - Update package.json scripts for Vite
   - Remove react-scripts dependency

   Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
   ```
  </action>
  <verify>
   - `npm run dev` starts Vite dev server at localhost:3000
   - `npm run build` succeeds with output in build/
   - `npm run preview` serves production build
   - All existing pages render correctly
   - No react-scripts in package.json dependencies
   - No public/index.html (moved to root)
  </verify>
  <done>CRA fully replaced with Vite, all pages render, development and production builds work</done>
</task>

</tasks>

<verification>
Run after all tasks complete:

1. Development server: `npm run dev` shows app at http://localhost:3000
2. Production build: `npm run build` completes without errors
3. Production preview: `npm run preview` serves the built app
4. Route testing: Navigate to /, /about, /contact, /gallery, /listen, /discography
5. No console errors in browser DevTools
6. CSS Modules still work (styling preserved - they're still in place)
</verification>

<success_criteria>
- Vite replaces CRA as the build system
- Development server starts in under 2 seconds
- Production build completes successfully
- All existing functionality preserved (routes, components, styling)
- No visual regressions from the CRA version
</success_criteria>

<output>
After completion, create `.planning/phases/01-tailwind-migration/01-01-SUMMARY.md`
</output>
