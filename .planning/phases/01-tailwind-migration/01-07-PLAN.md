---
phase: 01-tailwind-migration
plan: 07
type: execute
wave: 5
depends_on: ["01-06"]
files_modified:
  - .storybook/main.ts
  - .storybook/preview.tsx
  - src/stories/*.stories.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Developer can run `npm run storybook` and see all component stories"
    - "Storybook components render with Tailwind styling"
    - "No CSS Module files remain in components directory"
    - "Production build succeeds without CSS Module artifacts"
  artifacts:
    - path: ".storybook/main.ts"
      provides: "Storybook configuration for Vite"
      contains: "@storybook/react-vite"
    - path: ".storybook/preview.tsx"
      provides: "Storybook preview with Tailwind import"
      contains: "globals.css"
  key_links:
    - from: ".storybook/preview.tsx"
      to: "src/styles/globals.css"
      via: "CSS import"
      pattern: "import.*globals\\.css"
---

<objective>
Update Storybook for Vite/Tailwind and clean up CSS Module artifacts

Purpose: Complete the migration by updating Storybook to work with Vite and Tailwind, then remove all CSS Module files that are no longer imported. This ensures the build system is fully cleaned up.

Output: Working Storybook with Tailwind styling, no CSS Module files in codebase.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-tailwind-migration/01-RESEARCH.md

# Prior plan output - all components migrated
@.planning/phases/01-tailwind-migration/01-06-SUMMARY.md

# Current Storybook config
@.storybook/main.ts
@.storybook/preview.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Storybook for Vite</name>
  <files>
    .storybook/main.ts
    .storybook/preview.tsx
    package.json
  </files>
  <action>
1. Install Storybook Vite builder (if not already):
   ```bash
   npm install @storybook/react-vite --save-dev
   ```

2. Remove CRA-specific Storybook preset:
   ```bash
   npm uninstall @storybook/preset-create-react-app
   ```

3. Update .storybook/main.ts for Vite:
   ```typescript
   import type { StorybookConfig } from "@storybook/react-vite"

   const config: StorybookConfig = {
     stories: [
       "../src/**/*.mdx",
       "../src/**/*.stories.@(js|jsx|mjs|ts|tsx)",
     ],
     addons: [
       "@storybook/addon-docs",
       "@storybook/addon-a11y",
     ],
     framework: {
       name: "@storybook/react-vite",
       options: {},
     },
     docs: {
       autodocs: "tag",
     },
     viteFinal: async (config) => {
       // Vite config is automatically picked up from vite.config.ts
       return config
     },
   }

   export default config
   ```

4. Update .storybook/preview.tsx to import Tailwind:
   ```typescript
   import type { Preview } from "@storybook/react"
   import "../src/styles/globals.css" // Tailwind CSS
   import React from "react"
   import { MemoryRouter } from "react-router-dom"

   const preview: Preview = {
     decorators: [
       (Story) => (
         <MemoryRouter>
           <Story />
         </MemoryRouter>
       ),
     ],
     parameters: {
       controls: {
         matchers: {
           color: /(background|color)$/i,
           date: /Date$/i,
         },
       },
       backgrounds: {
         default: "light",
         values: [
           { name: "light", value: "#ffffff" },
           { name: "dark", value: "#0a0a0a" },
         ],
       },
     },
   }

   export default preview
   ```

5. Verify Storybook starts:
   ```bash
   npm run storybook
   ```

NOTE: Storybook 10 with Vite requires @storybook/react-vite builder.
  </action>
  <verify>
   - .storybook/main.ts uses @storybook/react-vite
   - .storybook/preview.tsx imports globals.css
   - `npm run storybook` starts without errors
   - Components render with Tailwind styling in Storybook
  </verify>
  <done>Storybook updated for Vite with Tailwind CSS support</done>
</task>

<task type="auto">
  <name>Task 2: Update stories for Tailwind components</name>
  <files>
    src/stories/Heading.stories.tsx
    src/stories/Surface.stories.tsx
    src/stories/Text.stories.tsx
  </files>
  <action>
1. Check if stories need updates for new CVA variant props

2. Update Heading.stories.tsx to use CVA variants:
   ```typescript
   import type { Meta, StoryObj } from "@storybook/react"
   import Heading from "../components/Heading"

   const meta: Meta<typeof Heading> = {
     title: "Components/Heading",
     component: Heading,
     tags: ["autodocs"],
     argTypes: {
       level: {
         control: { type: "select" },
         options: [1, 2, 3, 4, 5, 6],
       },
       tone: {
         control: { type: "select" },
         options: ["light", "dark", "accent"],
       },
       align: {
         control: { type: "select" },
         options: ["left", "center", "right"],
       },
       uppercase: {
         control: { type: "boolean" },
       },
     },
   }

   export default meta
   type Story = StoryObj<typeof meta>

   export const Default: Story = {
     args: {
       children: "Heading Text",
       level: 2,
       tone: "dark",
     },
   }

   export const AllLevels: Story = {
     render: () => (
       <div className="space-y-4">
         <Heading level={1}>Heading 1</Heading>
         <Heading level={2}>Heading 2</Heading>
         <Heading level={3}>Heading 3</Heading>
         <Heading level={4}>Heading 4</Heading>
         <Heading level={5}>Heading 5</Heading>
         <Heading level={6}>Heading 6</Heading>
       </div>
     ),
   }
   ```

3. Update Surface.stories.tsx and Text.stories.tsx similarly with CVA variant controls

4. Verify stories render correctly in Storybook

NOTE: Preserve any existing story variations, just update the controls for new variants.
  </action>
  <verify>
   - Stories load without errors
   - Variant controls work in Storybook UI
   - Components display correctly in stories
  </verify>
  <done>Stories updated for CVA-based components</done>
</task>

<task type="auto">
  <name>Task 3: Remove CSS Module files and finalize cleanup</name>
  <files>
    src/components/*.module.css (delete)
    src/pages/*.module.css (keep for now - pages not migrated)
    src/patterns/*.module.css (delete)
    src/App.module.css (delete)
    src/index.module.css (delete)
    src/variables.css (delete if migrated to globals.css)
  </files>
  <action>
1. First, verify no component imports CSS Modules:
   ```bash
   grep -r "\.module\.css" src/components/ src/patterns/ src/App.tsx
   ```
   Should return nothing or only comments.

2. Delete migrated CSS Module files in components/:
   ```bash
   rm src/components/Heading.module.css
   rm src/components/Text.module.css
   rm src/components/Surface.module.css
   rm src/components/Button.module.css
   rm src/components/Input.module.css
   rm src/components/TextArea.module.css
   rm src/components/Select.module.css
   rm src/components/Checkbox.module.css
   rm src/components/Label.module.css
   rm src/components/Alert.module.css
   rm src/components/Badge.module.css
   rm src/components/Modal.module.css
   rm src/components/Spinner.module.css
   rm src/components/Avatar.module.css
   rm src/components/Caption.module.css
   rm src/components/PostCard.module.css
   rm src/components/SocialShare.module.css
   rm src/components/CookieConsent.module.css
   rm src/components/GroupLabel.module.css
   ```

3. Delete migrated pattern CSS Modules:
   ```bash
   rm src/patterns/Header.module.css
   rm src/patterns/Footer.module.css
   ```

4. Delete app-level CSS Modules:
   ```bash
   rm src/App.module.css
   rm src/index.module.css
   ```

5. If variables.css is fully migrated to globals.css, delete it:
   ```bash
   rm src/variables.css  # Only if all variables moved to globals.css
   ```

6. NOTE: Keep page-level CSS Modules (src/pages/*.module.css) for now - they'll be migrated in future phases as pages are enhanced

7. Update .stylelintrc.json if it has CSS Module-specific rules that are no longer needed

8. Verify build still works:
   ```bash
   npm run build
   ```

9. Commit cleanup:
   ```bash
   git add -A
   git commit -m "chore(01-07): remove CSS Module files, update Storybook for Vite

   - Update Storybook to use @storybook/react-vite
   - Remove @storybook/preset-create-react-app
   - Update preview.tsx to import Tailwind globals
   - Update stories with CVA variant controls
   - Delete 19 component CSS Module files
   - Delete 2 pattern CSS Module files
   - Delete App.module.css and index.module.css
   - Keep page CSS Modules for future migration

   Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
   ```
  </action>
  <verify>
   - No CSS Module imports in migrated components (grep returns empty)
   - `npm run build` succeeds
   - `npm run storybook` works
   - `npm run dev` shows app correctly
   - No TypeScript errors
  </verify>
  <done>CSS Module files removed, Storybook fully updated, migration complete</done>
</task>

</tasks>

<verification>
Run after all tasks complete:

1. Storybook verification:
   ```bash
   npm run storybook
   ```
   - All stories render with Tailwind styling
   - Variant controls work

2. Build verification:
   ```bash
   npm run build
   ```
   - No CSS Module references in build errors
   - Build completes successfully

3. Dev verification:
   ```bash
   npm run dev
   ```
   - App runs without errors
   - All pages render correctly

4. File verification:
   ```bash
   find src/components src/patterns -name "*.module.css"
   ```
   - Should return empty (no CSS Modules in components/patterns)
</verification>

<success_criteria>
- Storybook uses Vite builder and renders Tailwind components
- All component CSS Module files deleted
- Pattern CSS Module files deleted
- App-level CSS Module files deleted
- Build succeeds without CSS Module artifacts
- Development server runs correctly
- Stories render with proper styling
</success_criteria>

<output>
After completion, create `.planning/phases/01-tailwind-migration/01-07-SUMMARY.md`
</output>
