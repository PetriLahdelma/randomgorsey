---
phase: 05-smooth-scroll-integration
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/lib/motion/hooks.ts
  - src/lib/motion/index.ts
  - src/pages/Home.tsx
  - src/pages/Gallery.tsx
autonomous: true

must_haves:
  truths:
    - "User navigating to new page starts at top (not scroll position from previous page)"
    - "User clicking Back to Top button on Home scrolls smoothly via Lenis"
    - "User opening Gallery overlay does not scroll background"
  artifacts:
    - path: "src/lib/motion/hooks.ts"
      provides: "useScrollToTopOnRouteChange and useLenisScrollTo hooks"
      min_lines: 25
    - path: "src/pages/Home.tsx"
      provides: "Back to Top using useLenisScrollTo"
      contains: "useLenisScrollTo"
    - path: "src/pages/Gallery.tsx"
      provides: "Scroll lock for overlay"
      contains: "data-lenis-prevent"
  key_links:
    - from: "src/lib/motion/hooks.ts"
      to: "lenis/react"
      via: "useLenis hook"
      pattern: "useLenis"
    - from: "src/pages/Home.tsx"
      to: "src/lib/motion/hooks.ts"
      via: "import useLenisScrollTo"
      pattern: "useLenisScrollTo"
---

<objective>
Wire scroll utilities for route changes, programmatic scroll, and overlay handling

Purpose: Ensure smooth scroll behavior integrates correctly with routing and modal overlays
Output: Custom hooks for scroll control, Home Back to Top uses Lenis, Gallery overlay locks scroll
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-smooth-scroll-integration/05-RESEARCH.md
@.planning/phases/05-smooth-scroll-integration/05-01-SUMMARY.md
@src/pages/Home.tsx
@src/pages/Gallery.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scroll utility hooks</name>
  <files>src/lib/motion/hooks.ts, src/lib/motion/index.ts</files>
  <action>
Create a new hooks.ts file with custom scroll hooks:

1. `useScrollToTopOnRouteChange` - Scrolls to top when route changes
2. `useLenisScrollTo` - Returns a function to scroll to position/element via Lenis (with fallback)

```typescript
// src/lib/motion/hooks.ts
import { useEffect, useCallback } from 'react';
import { useLocation } from 'react-router-dom';
import { useLenis } from 'lenis/react';

/**
 * Scrolls to top of page when route changes.
 * Works with both Lenis (if active) and native scroll.
 *
 * Must be called within a component inside BrowserRouter.
 */
export function useScrollToTopOnRouteChange(): void {
  const lenis = useLenis();
  const location = useLocation();

  useEffect(() => {
    // Immediate scroll to prevent seeing previous position
    if (lenis) {
      lenis.scrollTo(0, { immediate: true });
    } else {
      window.scrollTo(0, 0);
    }
  }, [location.pathname, lenis]);
}

interface ScrollToOptions {
  /** Scroll duration in seconds (ignored if immediate=true). Default: 1.2 */
  duration?: number;
  /** Skip animation and jump immediately. Default: false */
  immediate?: boolean;
  /** Offset from target in pixels. Default: 0 */
  offset?: number;
}

/**
 * Returns a function to programmatically scroll via Lenis or native fallback.
 *
 * @example
 * ```tsx
 * const scrollTo = useLenisScrollTo();
 *
 * // Scroll to top
 * scrollTo(0);
 *
 * // Scroll to element
 * scrollTo('#section-id', { duration: 1.5 });
 *
 * // Scroll to position with offset
 * scrollTo(500, { offset: -100 });
 * ```
 */
export function useLenisScrollTo() {
  const lenis = useLenis();

  const scrollTo = useCallback(
    (target: number | string, options: ScrollToOptions = {}) => {
      const { duration = 1.2, immediate = false, offset = 0 } = options;

      if (lenis) {
        lenis.scrollTo(target, { duration, immediate, offset });
      } else {
        // Native fallback
        if (typeof target === 'number') {
          window.scrollTo({
            top: target + offset,
            behavior: immediate ? 'auto' : 'smooth',
          });
        } else {
          // Target is a selector
          const element = document.querySelector(target);
          if (element) {
            const top = element.getBoundingClientRect().top + window.scrollY + offset;
            window.scrollTo({
              top,
              behavior: immediate ? 'auto' : 'smooth',
            });
          }
        }
      }
    },
    [lenis]
  );

  return scrollTo;
}
```

Update index.ts to export these hooks:
```typescript
// === HOOKS ===
export { useScrollToTopOnRouteChange, useLenisScrollTo } from './hooks';
```
  </action>
  <verify>`npm run ts:check:types` passes</verify>
  <done>useScrollToTopOnRouteChange and useLenisScrollTo hooks created and exported</done>
</task>

<task type="auto">
  <name>Task 2: Update Home.tsx Back to Top button</name>
  <files>src/pages/Home.tsx</files>
  <action>
Update the Home page to use useLenisScrollTo for the Back to Top button instead of window.scrollTo.

Changes:
1. Import useLenisScrollTo from '@/lib/motion'
2. Call the hook at component level
3. Replace `window.scrollTo({ top: 0, behavior: "smooth" })` with `scrollTo(0)`

Before:
```tsx
onClick={() => window.scrollTo({ top: 0, behavior: "smooth" })}
```

After:
```tsx
const scrollTo = useLenisScrollTo();
// ...
onClick={() => scrollTo(0)}
```

This ensures the Back to Top button uses Lenis smooth scroll on desktop and falls back to native smooth scroll on mobile.
  </action>
  <verify>`npm run build` succeeds</verify>
  <done>Home.tsx Back to Top uses useLenisScrollTo hook</done>
</task>

<task type="auto">
  <name>Task 3: Add scroll lock for Gallery overlay</name>
  <files>src/pages/Gallery.tsx</files>
  <action>
Prevent background scroll when Gallery overlay is open by adding `data-lenis-prevent` attribute.

The Gallery overlay already has AnimatePresence and motion.div. Add the data attribute to prevent Lenis from processing scroll events when the overlay is visible.

Update the overlay motion.div:
```tsx
<motion.div
  className={styles['overlay']}
  onClick={closeOverlay}
  variants={overlayVariants}
  initial="initial"
  animate="enter"
  exit="exit"
  data-lenis-prevent  // Add this attribute
>
```

This tells Lenis to ignore scroll events on this element and its children, preventing background scroll while the image overlay is open.
  </action>
  <verify>`npm run build` succeeds</verify>
  <done>Gallery overlay has data-lenis-prevent for scroll lock</done>
</task>

</tasks>

<verification>
1. `npm run build` - Production build succeeds
2. `npm run ts:check:types` - No TypeScript errors
3. Manual test: Navigate between pages, each should start at top
4. Manual test: Click Back to Top on Home, should scroll smoothly
5. Manual test: Open Gallery image overlay, background should not scroll
</verification>

<success_criteria>
- Custom scroll hooks exported from @/lib/motion
- Home Back to Top uses Lenis-compatible scroll
- Gallery overlay prevents background scrolling
- Route changes scroll to top
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-smooth-scroll-integration/05-03-SUMMARY.md`
</output>
