---
phase: 05-smooth-scroll-integration
plan: 05
type: execute
wave: 3
depends_on: ["05-03", "05-04"]
files_modified:
  - src/App.tsx
  - src/stories/RevealOnScroll.stories.tsx
autonomous: false

must_haves:
  truths:
    - "User navigating between pages always starts at scroll position 0"
    - "RevealOnScroll component has Storybook story with interactive controls"
    - "Phase verification passes for all success criteria"
  artifacts:
    - path: "src/App.tsx"
      provides: "Route change scroll reset hook"
      contains: "useScrollToTopOnRouteChange"
    - path: "src/stories/RevealOnScroll.stories.tsx"
      provides: "Storybook documentation for RevealOnScroll"
      min_lines: 40
  key_links:
    - from: "src/App.tsx"
      to: "src/lib/motion/hooks.ts"
      via: "useScrollToTopOnRouteChange import"
      pattern: "useScrollToTopOnRouteChange"
---

<objective>
Complete integration with route-based scroll reset and Storybook documentation

Purpose: Finalize Phase 5 with proper scroll behavior on navigation and component documentation
Output: App.tsx uses scroll reset hook, RevealOnScroll has Storybook story, phase verified
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-smooth-scroll-integration/05-RESEARCH.md
@.planning/phases/05-smooth-scroll-integration/05-03-SUMMARY.md
@.planning/phases/05-smooth-scroll-integration/05-04-SUMMARY.md
@src/App.tsx
@src/lib/motion/hooks.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire scroll-to-top on route change in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
The useScrollToTopOnRouteChange hook must be called inside BrowserRouter (it uses useLocation).

Create a small wrapper component that calls the hook, then include it in App.

Option 1: Create ScrollToTop component inline:
```tsx
import { useScrollToTopOnRouteChange } from '@/lib/motion';

// Inside App.tsx, after imports:
const ScrollToTop: React.FC = () => {
  useScrollToTopOnRouteChange();
  return null;
};

// In App render, inside BrowserRouter:
<BrowserRouter>
  <ScrollToTop />
  <div className={...}>
    ...
  </div>
</BrowserRouter>
```

Option 2 (preferred): Create a separate ScrollReset component.

Since this is a small, app-specific utility, inline in App.tsx is fine. The key is that it's INSIDE BrowserRouter since useLocation requires router context.

Update App.tsx:
1. Import useScrollToTopOnRouteChange from '@/lib/motion'
2. Create ScrollToTop component (can be arrow function returning null)
3. Add <ScrollToTop /> as first child of BrowserRouter
  </action>
  <verify>Navigate between pages in browser - each page starts at top</verify>
  <done>App.tsx scrolls to top on every route change</done>
</task>

<task type="auto">
  <name>Task 2: Create RevealOnScroll Storybook story</name>
  <files>src/stories/RevealOnScroll.stories.tsx</files>
  <action>
Create a Storybook story for RevealOnScroll following project patterns.

The story should demonstrate:
1. Default reveal behavior
2. Configurable amount threshold
3. Different semantic elements (div, section)
4. Reduced motion behavior

```tsx
import type { Meta, StoryObj } from '@storybook/react';
import RevealOnScroll from '../components/RevealOnScroll';

const meta: Meta<typeof RevealOnScroll> = {
  title: 'Components/RevealOnScroll',
  component: RevealOnScroll,
  tags: ['autodocs'],
  parameters: {
    layout: 'padded',
    docs: {
      description: {
        component: 'Wrapper component for scroll-triggered reveal animations. Respects reduced-motion preferences.',
      },
    },
  },
  argTypes: {
    as: {
      control: 'select',
      options: ['div', 'section', 'article', 'aside'],
      description: 'HTML element to render',
    },
    once: {
      control: 'boolean',
      description: 'Trigger animation only once',
    },
    amount: {
      control: { type: 'range', min: 0, max: 1, step: 0.1 },
      description: 'Visibility threshold (0-1)',
    },
  },
};

export default meta;
type Story = StoryObj<typeof RevealOnScroll>;

// Helper to create scrollable container
const ScrollContainer = ({ children }: { children: React.ReactNode }) => (
  <div style={{ height: '150vh', paddingTop: '100vh' }}>
    <p style={{ position: 'fixed', top: 20, left: 20, color: '#666' }}>
      Scroll down to see the reveal animation
    </p>
    {children}
  </div>
);

export const Default: Story = {
  render: (args) => (
    <ScrollContainer>
      <RevealOnScroll {...args}>
        <div style={{
          padding: '2rem',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          borderRadius: '8px',
          color: 'white',
        }}>
          <h2>Revealed Content</h2>
          <p>This content animates into view when you scroll down.</p>
        </div>
      </RevealOnScroll>
    </ScrollContainer>
  ),
  args: {
    once: true,
    amount: 0.3,
  },
};

export const MultipleItems: Story = {
  render: () => (
    <ScrollContainer>
      <div style={{ display: 'flex', flexDirection: 'column', gap: '2rem' }}>
        {[1, 2, 3, 4, 5].map((i) => (
          <RevealOnScroll key={i}>
            <div style={{
              padding: '2rem',
              background: `hsl(${i * 40}, 70%, 60%)`,
              borderRadius: '8px',
              color: 'white',
            }}>
              <h3>Item {i}</h3>
              <p>Each item reveals independently as it enters the viewport.</p>
            </div>
          </RevealOnScroll>
        ))}
      </div>
    </ScrollContainer>
  ),
};

export const AsSection: Story = {
  render: (args) => (
    <ScrollContainer>
      <RevealOnScroll as="section" {...args}>
        <div style={{
          padding: '3rem',
          background: '#1a1a2e',
          borderRadius: '12px',
          color: 'white',
        }}>
          <h2>Section Element</h2>
          <p>This renders as a semantic section element.</p>
        </div>
      </RevealOnScroll>
    </ScrollContainer>
  ),
  args: {
    as: 'section',
    amount: 0.5,
  },
};
```
  </action>
  <verify>`npm run storybook` starts and RevealOnScroll story renders correctly</verify>
  <done>RevealOnScroll has Storybook story with multiple examples and controls</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 5 Smooth Scroll Integration:
- Lenis smooth scroll on desktop
- Native scroll on mobile and reduced-motion
- RevealOnScroll component for scroll-triggered animations
- Home, About, Gallery pages with reveal animations
- Scroll-to-top on route change
- Gallery overlay scroll lock
- Storybook documentation
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:5173 in desktop browser

**Smooth Scroll Test:**
- Scroll with mouse wheel - should feel smooth/lerped, not jumpy
- Scrollbar thumb should move smoothly

**Reveal Animation Test:**
- Scroll down Home page - posts should fade+slide up as they enter viewport
- Visit /about - sections should reveal on scroll
- Visit /gallery - images should reveal on scroll

**Mobile/Reduced Motion Test:**
- Open DevTools > Sensors > Touch: Force enabled OR resize to mobile
- Reload page - scroll should feel native (no smooth lerp)
- OR: Enable "Reduce motion" in macOS System Preferences > Accessibility > Display
- Reload - scroll should be native, reveals should be fade-only

**Route Change Test:**
- Scroll down on any page
- Navigate to different page via header link
- New page should start at top (not scrolled)

**Gallery Overlay Test:**
- Visit /gallery
- Click an image to open overlay
- Try scrolling - background should NOT scroll

**Storybook Test:**
- Run `npm run storybook`
- Navigate to Components > RevealOnScroll
- Verify story renders and controls work
  </how-to-verify>
  <resume-signal>Type "approved" to confirm Phase 5 complete, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` - Production build succeeds
2. `npm run ts:check:types` - No TypeScript errors
3. `npm run storybook` - Storybook builds and RevealOnScroll story works
4. All manual tests from checkpoint pass
</verification>

<success_criteria>
Phase 5 complete when:
- Desktop users experience smooth scroll (Lenis)
- Mobile/touch users get native scroll
- Reduced-motion users get native scroll
- Content reveals on scroll (Home, About, Gallery)
- Route changes reset scroll to top
- Gallery overlay locks background scroll
- RevealOnScroll documented in Storybook
- Build and TypeScript checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-smooth-scroll-integration/05-05-SUMMARY.md`
</output>
