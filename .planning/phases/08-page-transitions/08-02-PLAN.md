---
phase: 08-page-transitions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/cursor/CursorProvider.tsx
  - src/lib/cursor/CustomCursor.tsx
  - src/lib/cursor/index.ts
  - src/styles/globals.css
autonomous: true

must_haves:
  truths:
    - "User on desktop sees custom circular cursor following mouse position"
    - "User on touch device sees native cursor (no custom cursor rendered)"
    - "User with reduced motion preference sees no animated cursor"
    - "User can click all interactive elements normally (cursor doesn't block)"
    - "Cursor reacts to hover states (grows on interactive elements)"
  artifacts:
    - path: "src/lib/cursor/CursorProvider.tsx"
      provides: "Cursor context with device detection and state management"
      exports: ["CursorProvider", "useCursor"]
    - path: "src/lib/cursor/CustomCursor.tsx"
      provides: "Visual cursor element with spring-based motion"
      exports: ["CustomCursor"]
    - path: "src/lib/cursor/index.ts"
      provides: "Public barrel exports"
      exports: ["CursorProvider", "useCursor"]
    - path: "src/styles/globals.css"
      provides: "Global cursor hiding CSS"
      contains: "cursor: none"
  key_links:
    - from: "src/lib/cursor/CursorProvider.tsx"
      to: "(hover: hover) and (pointer: fine)"
      via: "matchMedia for desktop detection"
      pattern: "matchMedia.*pointer.*fine"
    - from: "src/lib/cursor/CustomCursor.tsx"
      to: "framer-motion useSpring"
      via: "smooth cursor position"
      pattern: "useSpring"
---

<objective>
Create custom cursor system with desktop-only rendering and touch device fallback.

Purpose: A custom cursor adds personality to the site on desktop, but must gracefully fall back to native cursor on touch devices. The cursor should feel responsive and not block any interactions.

Output: CursorProvider context, CustomCursor visual component, and supporting CSS
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-transitions/08-RESEARCH.md

# Existing infrastructure
@src/lib/motion/config.ts
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cursor module with CursorProvider and useCursor hook</name>
  <files>src/lib/cursor/CursorProvider.tsx, src/lib/cursor/index.ts</files>
  <action>
Create src/lib/cursor/ directory with:

**CursorProvider.tsx:**
```tsx
import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';
import { useReducedMotion } from 'framer-motion';
import { CustomCursor } from './CustomCursor';

type CursorVariant = 'default' | 'hover' | 'text';

interface CursorContextType {
  cursorVariant: CursorVariant;
  setCursorVariant: (variant: CursorVariant) => void;
}

const CursorContext = createContext<CursorContextType | null>(null);

interface CursorProviderProps {
  children: ReactNode;
}

export function CursorProvider({ children }: CursorProviderProps) {
  const [cursorVariant, setCursorVariant] = useState<CursorVariant>('default');
  const [isDesktop, setIsDesktop] = useState(false);
  const prefersReducedMotion = useReducedMotion();

  useEffect(() => {
    // Check for fine pointer (mouse) + hover capability
    const checkDesktop = () => {
      const query = window.matchMedia('(hover: hover) and (pointer: fine)');
      setIsDesktop(query.matches);
    };

    checkDesktop();

    const query = window.matchMedia('(hover: hover) and (pointer: fine)');
    query.addEventListener('change', checkDesktop);
    return () => query.removeEventListener('change', checkDesktop);
  }, []);

  // Add body class for CSS cursor hiding
  useEffect(() => {
    if (isDesktop && !prefersReducedMotion) {
      document.body.classList.add('custom-cursor-active');
    } else {
      document.body.classList.remove('custom-cursor-active');
    }
    return () => document.body.classList.remove('custom-cursor-active');
  }, [isDesktop, prefersReducedMotion]);

  // Don't render custom cursor on touch or reduced motion
  if (!isDesktop || prefersReducedMotion) {
    return <>{children}</>;
  }

  return (
    <CursorContext.Provider value={{ cursorVariant, setCursorVariant }}>
      {children}
      <CustomCursor variant={cursorVariant} />
    </CursorContext.Provider>
  );
}

export function useCursor() {
  const context = useContext(CursorContext);
  // Return no-op if outside provider (touch devices)
  if (!context) {
    return {
      cursorVariant: 'default' as CursorVariant,
      setCursorVariant: () => {},
    };
  }
  return context;
}
```

**index.ts:**
```ts
export { CursorProvider, useCursor } from './CursorProvider';
```
  </action>
  <verify>
`npm run ts:check:types` passes
Directory and files exist at src/lib/cursor/
  </verify>
  <done>
CursorProvider context created with desktop detection
useCursor hook returns context or no-op for touch devices
Body class added/removed based on device type
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CustomCursor visual component</name>
  <files>src/lib/cursor/CustomCursor.tsx</files>
  <action>
Create CustomCursor component with spring-based mouse following:

```tsx
import { useEffect } from 'react';
import { motion, useMotionValue, useSpring, type Variants } from 'framer-motion';

interface CustomCursorProps {
  variant: 'default' | 'hover' | 'text';
}

export function CustomCursor({ variant }: CustomCursorProps) {
  const cursorX = useMotionValue(0);
  const cursorY = useMotionValue(0);

  // Spring config for smooth, slightly elastic following
  const springConfig = { stiffness: 500, damping: 28, mass: 0.5 };
  const smoothX = useSpring(cursorX, springConfig);
  const smoothY = useSpring(cursorY, springConfig);

  useEffect(() => {
    const handleMouseMove = (e: MouseEvent) => {
      cursorX.set(e.clientX);
      cursorY.set(e.clientY);
    };

    window.addEventListener('mousemove', handleMouseMove);
    return () => window.removeEventListener('mousemove', handleMouseMove);
  }, [cursorX, cursorY]);

  const variants: Variants = {
    default: {
      width: 16,
      height: 16,
      backgroundColor: 'rgba(255, 255, 255, 0.6)',
      mixBlendMode: 'difference' as const,
    },
    hover: {
      width: 48,
      height: 48,
      backgroundColor: 'rgba(255, 214, 0, 0.8)', // Brand yellow
      mixBlendMode: 'normal' as const,
    },
    text: {
      width: 80,
      height: 80,
      backgroundColor: 'rgba(255, 255, 255, 0.1)',
      mixBlendMode: 'difference' as const,
    },
  };

  return (
    <motion.div
      className="fixed top-0 left-0 rounded-full pointer-events-none z-[9999]"
      style={{
        x: smoothX,
        y: smoothY,
        translateX: '-50%',
        translateY: '-50%',
      }}
      variants={variants}
      animate={variant}
      transition={{ type: 'spring', stiffness: 500, damping: 28 }}
    />
  );
}
```

Key properties:
- fixed positioning with z-[9999] to stay on top
- pointer-events-none so it doesn't block clicks
- translateX/Y -50% to center on cursor position
- Spring-based smoothing for natural feel
- Three variants: default (small), hover (medium yellow), text (large blend)
  </action>
  <verify>
`npm run ts:check:types` passes
File exists at src/lib/cursor/CustomCursor.tsx
  </verify>
  <done>
CustomCursor component created with spring-based motion
Three cursor variants: default, hover, text
Properly centered on mouse position
  </done>
</task>

<task type="auto">
  <name>Task 3: Add cursor hiding CSS to globals.css</name>
  <files>src/styles/globals.css</files>
  <action>
Add cursor hiding styles at the end of globals.css (before any closing comments):

```css
/* === CUSTOM CURSOR === */
/* Hide default cursor when custom cursor is active (desktop only) */
@media (hover: hover) and (pointer: fine) {
  body.custom-cursor-active {
    cursor: none;
  }

  body.custom-cursor-active a,
  body.custom-cursor-active button,
  body.custom-cursor-active [role="button"],
  body.custom-cursor-active input,
  body.custom-cursor-active textarea,
  body.custom-cursor-active select,
  body.custom-cursor-active label {
    cursor: none;
  }
}

/* Touch/mobile devices - always show native cursor */
@media (hover: none), (pointer: coarse) {
  .custom-cursor {
    display: none !important;
  }
}
```

This ensures:
- Native cursor hidden only on desktop when custom cursor active
- All interactive elements also hide cursor
- Touch devices always use native cursor
  </action>
  <verify>
`npm run build` succeeds
CSS is valid (no syntax errors)
  </verify>
  <done>
Cursor hiding CSS added to globals.css
Desktop cursor hidden when body has custom-cursor-active class
Touch devices unaffected
  </done>
</task>

</tasks>

<verification>
1. `npm run ts:check:types` - no TypeScript errors
2. `npm run build` - production build succeeds
3. File structure:
   - src/lib/cursor/CursorProvider.tsx exists
   - src/lib/cursor/CustomCursor.tsx exists
   - src/lib/cursor/index.ts exports CursorProvider and useCursor
4. Manual verification (after integration in 08-04):
   - Desktop: custom cursor visible, native cursor hidden
   - Touch device / mobile simulator: native cursor, no custom cursor rendered
</verification>

<success_criteria>
- CursorProvider detects desktop vs touch using media query
- CustomCursor uses spring-based motion values
- useCursor hook returns no-op outside provider (touch devices)
- CSS hides native cursor only when custom-cursor-active class present
- No pointer-events blocking (all clicks work)
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-transitions/08-02-SUMMARY.md`
</output>
