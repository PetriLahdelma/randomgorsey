---
phase: 08-page-transitions
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/KineticText.tsx
  - src/lib/motion/variants.ts
  - src/lib/motion/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees text characters/words animate in with staggered timing"
    - "User with reduced motion sees static text instantly (no animation)"
    - "Screen reader announces full text despite split DOM structure"
    - "Text animation triggers on scroll into view (whileInView)"
  artifacts:
    - path: "package.json"
      provides: "split-type dependency"
      contains: "split-type"
    - path: "src/components/KineticText.tsx"
      provides: "SplitType wrapper component for kinetic typography"
      exports: ["KineticText"]
    - path: "src/lib/motion/variants.ts"
      provides: "Text reveal variants for character/word animations"
      contains: "textRevealVariants"
  key_links:
    - from: "src/components/KineticText.tsx"
      to: "split-type"
      via: "text splitting on mount"
      pattern: "new SplitType"
    - from: "src/components/KineticText.tsx"
      to: "framer-motion"
      via: "stagger animation on split elements"
      pattern: "staggerChildren"
---

<objective>
Create KineticText component using SplitType for character/word-level text animations.

Purpose: Kinetic typography adds visual impact to key headings by animating individual characters or words. SplitType handles the complex text splitting while Framer Motion handles animation.

Output: KineticText component with configurable split modes and stagger timing
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-transitions/08-RESEARCH.md

# Existing infrastructure
@src/lib/motion/config.ts
@src/lib/motion/variants.ts
@src/lib/motion/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install split-type dependency</name>
  <files>package.json</files>
  <action>
Install split-type package:

```bash
npm install split-type
```

This is a lightweight text splitting library that:
- Wraps characters, words, or lines in span elements
- Preserves whitespace and kerning
- Provides revert() method for cleanup
- No external dependencies

Verify package.json has split-type in dependencies after install.
  </action>
  <verify>
`npm ls split-type` shows installed version
package.json contains "split-type" in dependencies
  </verify>
  <done>
split-type installed as dependency
  </done>
</task>

<task type="auto">
  <name>Task 2: Add text reveal variants to motion system</name>
  <files>src/lib/motion/variants.ts, src/lib/motion/index.ts</files>
  <action>
Add kinetic text variants to variants.ts:

```typescript
// === KINETIC TEXT ANIMATIONS ===

/**
 * Container variant for kinetic text (character/word stagger).
 * Use with KineticText component.
 */
export const textRevealContainer: Variants = {
  hidden: {},
  visible: {
    transition: {
      staggerChildren: 0.03,
      delayChildren: 0.1,
    },
  },
};

/**
 * Item variant for individual characters/words in kinetic text.
 * Slides up and fades in with slight spring.
 */
export const textRevealItem: Variants = {
  hidden: {
    opacity: 0,
    y: 20,
  },
  visible: {
    opacity: 1,
    y: 0,
    transition: {
      duration: 0.4,
      ease: [0.4, 0, 0.2, 1], // eases.default
    },
  },
};

/**
 * Alternative text reveal - characters slide from below with rotation.
 * More dramatic effect for hero headings.
 */
export const textRevealDramatic: Variants = {
  hidden: {
    opacity: 0,
    y: 40,
    rotateX: -90,
  },
  visible: {
    opacity: 1,
    y: 0,
    rotateX: 0,
    transition: {
      duration: 0.6,
      ease: [0.4, 0, 0.2, 1],
    },
  },
};
```

Export from index.ts:
```typescript
export {
  // ... existing exports
  textRevealContainer,
  textRevealItem,
  textRevealDramatic,
} from './variants';
```
  </action>
  <verify>
`npm run ts:check:types` passes
Variants exported from @/lib/motion
  </verify>
  <done>
textRevealContainer, textRevealItem, textRevealDramatic added to variants.ts
Exported from index.ts
  </done>
</task>

<task type="auto">
  <name>Task 3: Create KineticText component</name>
  <files>src/components/KineticText.tsx</files>
  <action>
Create KineticText component:

```tsx
import { useEffect, useRef, useState } from 'react';
import { motion, useReducedMotion, useInView, type Variants } from 'framer-motion';
import SplitType from 'split-type';
import { cn } from '@/lib/utils';
import { textRevealContainer, textRevealItem, textRevealDramatic } from '@/lib/motion';

type SplitMode = 'chars' | 'words' | 'lines';
type AnimationVariant = 'default' | 'dramatic';

interface KineticTextProps {
  /** Text content to animate */
  children: string;
  /** HTML element to render */
  as?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | 'p' | 'span';
  /** How to split the text */
  splitBy?: SplitMode;
  /** Delay between each character/word (seconds) */
  staggerDelay?: number;
  /** Animation style */
  variant?: AnimationVariant;
  /** Trigger animation when scrolled into view */
  triggerOnView?: boolean;
  /** Viewport amount required to trigger (0-1) */
  viewportAmount?: number;
  /** Additional CSS classes */
  className?: string;
}

export function KineticText({
  children,
  as: Tag = 'span',
  splitBy = 'chars',
  staggerDelay = 0.03,
  variant = 'default',
  triggerOnView = true,
  viewportAmount = 0.5,
  className,
}: KineticTextProps) {
  const containerRef = useRef<HTMLElement>(null);
  const [splitElements, setSplitElements] = useState<Element[]>([]);
  const [isSplit, setIsSplit] = useState(false);
  const prefersReducedMotion = useReducedMotion();
  const isInView = useInView(containerRef, {
    once: true,
    amount: viewportAmount,
  });

  // Initialize SplitType on mount
  useEffect(() => {
    if (!containerRef.current || prefersReducedMotion) return;

    // Create split instance
    const split = new SplitType(containerRef.current, {
      types: splitBy,
      tagName: 'span',
    });

    // Get split elements based on mode
    const elements = split[splitBy] || [];
    setSplitElements(elements);
    setIsSplit(true);

    // Add inline-block to each split element for proper animation
    elements.forEach((el) => {
      (el as HTMLElement).style.display = 'inline-block';
    });

    // Cleanup: revert split on unmount
    return () => {
      split.revert();
      setIsSplit(false);
      setSplitElements([]);
    };
  }, [children, splitBy, prefersReducedMotion]);

  // Reduced motion: render static text immediately
  if (prefersReducedMotion) {
    return (
      <Tag className={className} aria-label={children}>
        {children}
      </Tag>
    );
  }

  const shouldAnimate = triggerOnView ? isInView : true;

  // Select item variant based on prop
  const itemVariant: Variants =
    variant === 'dramatic' ? textRevealDramatic : textRevealItem;

  // Custom container with configurable stagger
  const containerVariant: Variants = {
    hidden: {},
    visible: {
      transition: {
        staggerChildren: staggerDelay,
        delayChildren: 0.1,
      },
    },
  };

  return (
    <motion.span
      ref={containerRef as React.RefObject<HTMLSpanElement>}
      className={cn('kinetic-text', className)}
      style={{ fontKerning: 'none' }} // Prevent kerning issues with split text
      variants={containerVariant}
      initial="hidden"
      animate={shouldAnimate ? 'visible' : 'hidden'}
      aria-label={children}
    >
      {/*
        SplitType injects the split elements into the DOM.
        We animate them by adding motion wrappers after split.
        The actual text is rendered by SplitType, we just provide the container.
      */}
      {!isSplit && children}
      {isSplit &&
        splitElements.map((el, i) => (
          <motion.span
            key={i}
            variants={itemVariant}
            style={{ display: 'inline-block' }}
            aria-hidden="true"
            dangerouslySetInnerHTML={{ __html: el.innerHTML }}
          />
        ))}
    </motion.span>
  );
}

export default KineticText;
```

Key features:
- Uses SplitType for text splitting
- Supports chars, words, or lines mode
- Respects prefers-reduced-motion
- Triggers on scroll into view by default
- Accessible: aria-label on container, aria-hidden on split elements
- Cleanup via split.revert() on unmount
- Configurable stagger delay and animation variant
  </action>
  <verify>
`npm run ts:check:types` passes
`npm run build` succeeds
  </verify>
  <done>
KineticText component created with SplitType integration
Supports chars/words/lines splitting
Respects reduced motion preference
Accessible with aria-label
  </done>
</task>

</tasks>

<verification>
1. `npm run ts:check:types` - no TypeScript errors
2. `npm run build` - production build succeeds
3. `npm ls split-type` - dependency installed
4. File structure:
   - src/components/KineticText.tsx exists
   - src/lib/motion/variants.ts has textReveal* exports
   - src/lib/motion/index.ts exports textReveal*
</verification>

<success_criteria>
- split-type installed as dependency
- KineticText component accepts text children and animates individual characters/words
- Animation triggers on scroll into view by default
- Reduced motion users see static text
- Text variants (textRevealContainer, textRevealItem, textRevealDramatic) exported
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-transitions/08-03-SUMMARY.md`
</output>
