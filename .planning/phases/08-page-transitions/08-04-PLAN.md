---
phase: 08-page-transitions
plan: 04
type: execute
wave: 2
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - src/App.tsx
  - src/main.tsx
  - src/stories/cursor/CustomCursor.stories.tsx
  - src/stories/KineticText.stories.tsx
autonomous: true

must_haves:
  truths:
    - "User on desktop sees custom cursor on all pages"
    - "User can interact with cursor-aware elements (cursor changes on hover)"
    - "Storybook shows CustomCursor with interactive variant controls"
    - "Storybook shows KineticText with split mode and timing controls"
  artifacts:
    - path: "src/App.tsx"
      provides: "App shell with CursorProvider integration"
      contains: "CursorProvider"
    - path: "src/stories/cursor/CustomCursor.stories.tsx"
      provides: "Cursor Storybook documentation"
      exports: ["Default", "Hover", "Text"]
    - path: "src/stories/KineticText.stories.tsx"
      provides: "KineticText Storybook documentation"
      exports: ["Characters", "Words", "DramaticVariant"]
  key_links:
    - from: "src/App.tsx"
      to: "src/lib/cursor/CursorProvider.tsx"
      via: "Provider wrapping"
      pattern: "CursorProvider"
    - from: "src/stories/cursor/CustomCursor.stories.tsx"
      to: "src/lib/cursor"
      via: "import and decorator"
      pattern: "CursorProvider"
---

<objective>
Integrate cursor into App.tsx and create Storybook stories for cursor and KineticText.

Purpose: Wire the cursor system into the application and document both new features in Storybook with interactive controls.

Output: Working custom cursor site-wide, comprehensive Storybook documentation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-transitions/08-RESEARCH.md

# Prior plan SUMMARYs (dependencies)
@.planning/phases/08-page-transitions/08-01-SUMMARY.md
@.planning/phases/08-page-transitions/08-02-SUMMARY.md
@.planning/phases/08-page-transitions/08-03-SUMMARY.md

# Files to modify
@src/App.tsx
@src/components/KineticText.tsx
@src/lib/cursor/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate CursorProvider into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Update App.tsx to wrap the application with CursorProvider.

Add import:
```tsx
import { CursorProvider } from '@/lib/cursor';
```

Wrap the content inside AnimationProvider with CursorProvider:
```tsx
<AnimationProvider>
  <CursorProvider>
    <BrowserRouter>
      {/* ... existing content */}
    </BrowserRouter>
  </CursorProvider>
</AnimationProvider>
```

The provider hierarchy should be:
1. AnimationProvider (outermost - motion config)
2. CursorProvider (cursor state)
3. BrowserRouter (routing)
4. ... rest of app

CursorProvider will:
- Detect desktop vs touch automatically
- Render CustomCursor on desktop only
- Add custom-cursor-active class to body
- Provide useCursor hook context
  </action>
  <verify>
`npm run build` succeeds
`npm run dev` - cursor visible on desktop, hidden on mobile/touch
  </verify>
  <done>
CursorProvider wraps app content in App.tsx
Custom cursor visible on desktop browsers
Touch devices unaffected
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CustomCursor Storybook stories</name>
  <files>src/stories/cursor/CustomCursor.stories.tsx</files>
  <action>
Create src/stories/cursor/ directory and stories file:

```tsx
import type { Meta, StoryObj } from '@storybook/react';
import { useState } from 'react';
import { CursorProvider, useCursor } from '@/lib/cursor';

// Demo component to show cursor variants
function CursorDemo() {
  const { setCursorVariant, cursorVariant } = useCursor();

  return (
    <div className="min-h-[400px] p-8 bg-neutral-900 text-white">
      <h2 className="text-2xl mb-8">Current variant: {cursorVariant}</h2>

      <div className="space-y-4">
        <div
          className="p-4 bg-neutral-800 rounded cursor-pointer"
          onMouseEnter={() => setCursorVariant('default')}
        >
          <p>Default cursor area</p>
        </div>

        <button
          className="px-6 py-3 bg-yellow-500 text-black rounded font-semibold"
          onMouseEnter={() => setCursorVariant('hover')}
          onMouseLeave={() => setCursorVariant('default')}
        >
          Hover me (hover variant)
        </button>

        <div
          className="p-8 bg-neutral-800 rounded"
          onMouseEnter={() => setCursorVariant('text')}
          onMouseLeave={() => setCursorVariant('default')}
        >
          <h1 className="text-4xl font-bold">
            Large text area (text variant)
          </h1>
          <p className="mt-2 text-neutral-400">
            Hover over this area to see the text cursor
          </p>
        </div>
      </div>

      <p className="mt-8 text-neutral-500 text-sm">
        Note: Custom cursor only appears on desktop with fine pointer.
        Touch devices use native cursor.
      </p>
    </div>
  );
}

const meta: Meta = {
  title: 'Effects/CustomCursor',
  component: CursorDemo,
  decorators: [
    (Story) => (
      <CursorProvider>
        <Story />
      </CursorProvider>
    ),
  ],
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        component: `
Custom cursor that follows mouse position with spring-based smoothing.

## Features
- Desktop-only (uses \`(hover: hover) and (pointer: fine)\` detection)
- Three variants: default, hover, text
- Respects prefers-reduced-motion
- Uses mix-blend-mode for visibility on any background

## Usage
\`\`\`tsx
import { useCursor } from '@/lib/cursor';

function MyComponent() {
  const { setCursorVariant } = useCursor();

  return (
    <button
      onMouseEnter={() => setCursorVariant('hover')}
      onMouseLeave={() => setCursorVariant('default')}
    >
      Hover me
    </button>
  );
}
\`\`\`
        `,
      },
    },
  },
  tags: ['autodocs'],
};

export default meta;
type Story = StoryObj;

export const Interactive: Story = {
  name: 'Interactive Demo',
};

export const VariantShowcase: Story = {
  name: 'Variant Showcase',
  render: () => {
    const VariantDemo = () => {
      const { setCursorVariant } = useCursor();

      return (
        <div className="grid grid-cols-3 gap-4 min-h-[300px] p-4 bg-neutral-900">
          <div
            className="flex items-center justify-center bg-neutral-800 rounded p-8"
            onMouseEnter={() => setCursorVariant('default')}
          >
            <span className="text-white">Default</span>
          </div>
          <div
            className="flex items-center justify-center bg-neutral-800 rounded p-8"
            onMouseEnter={() => setCursorVariant('hover')}
            onMouseLeave={() => setCursorVariant('default')}
          >
            <span className="text-white">Hover</span>
          </div>
          <div
            className="flex items-center justify-center bg-neutral-800 rounded p-8"
            onMouseEnter={() => setCursorVariant('text')}
            onMouseLeave={() => setCursorVariant('default')}
          >
            <span className="text-white">Text</span>
          </div>
        </div>
      );
    };

    return (
      <CursorProvider>
        <VariantDemo />
      </CursorProvider>
    );
  },
};
```
  </action>
  <verify>
`npm run storybook` - CustomCursor stories visible under Effects category
Interactive demo shows cursor variants on hover
  </verify>
  <done>
CustomCursor stories created in src/stories/cursor/
Interactive demo with all three variants
Documentation in Storybook autodocs
  </done>
</task>

<task type="auto">
  <name>Task 3: Create KineticText Storybook stories</name>
  <files>src/stories/KineticText.stories.tsx</files>
  <action>
Create KineticText stories with interactive controls:

```tsx
import type { Meta, StoryObj } from '@storybook/react';
import { KineticText } from '@/components/KineticText';

const meta: Meta<typeof KineticText> = {
  title: 'Components/KineticText',
  component: KineticText,
  parameters: {
    layout: 'centered',
    docs: {
      description: {
        component: `
Kinetic typography component that splits text into characters, words, or lines
and animates them with staggered timing.

## Features
- Uses SplitType for text splitting
- Supports chars, words, or lines split modes
- Configurable stagger delay
- Triggers on scroll into view (optional)
- Respects prefers-reduced-motion
- Accessible: uses aria-label for screen readers

## Usage
\`\`\`tsx
import { KineticText } from '@/components/KineticText';

<KineticText as="h1" splitBy="chars" staggerDelay={0.02}>
  Hello World
</KineticText>
\`\`\`
        `,
      },
    },
  },
  tags: ['autodocs'],
  argTypes: {
    children: {
      control: 'text',
      description: 'Text content to animate',
    },
    as: {
      control: 'select',
      options: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span'],
      description: 'HTML element to render',
    },
    splitBy: {
      control: 'select',
      options: ['chars', 'words', 'lines'],
      description: 'How to split the text',
    },
    staggerDelay: {
      control: { type: 'range', min: 0.01, max: 0.2, step: 0.01 },
      description: 'Delay between each animated element (seconds)',
    },
    variant: {
      control: 'select',
      options: ['default', 'dramatic'],
      description: 'Animation style',
    },
    triggerOnView: {
      control: 'boolean',
      description: 'Whether to trigger animation on scroll into view',
    },
    viewportAmount: {
      control: { type: 'range', min: 0, max: 1, step: 0.1 },
      description: 'Viewport amount required to trigger (0-1)',
    },
  },
};

export default meta;
type Story = StoryObj<typeof KineticText>;

export const Characters: Story = {
  args: {
    children: 'Random Gorsey',
    as: 'h1',
    splitBy: 'chars',
    staggerDelay: 0.03,
    variant: 'default',
    triggerOnView: false,
    className: 'text-6xl font-bold text-white',
  },
  decorators: [
    (Story) => (
      <div className="p-12 bg-neutral-900 min-w-[600px]">
        <Story />
      </div>
    ),
  ],
};

export const Words: Story = {
  args: {
    children: 'Explore The Music Collection',
    as: 'h2',
    splitBy: 'words',
    staggerDelay: 0.08,
    variant: 'default',
    triggerOnView: false,
    className: 'text-4xl font-semibold text-white',
  },
  decorators: [
    (Story) => (
      <div className="p-12 bg-neutral-900 min-w-[600px]">
        <Story />
      </div>
    ),
  ],
};

export const DramaticVariant: Story = {
  name: 'Dramatic Animation',
  args: {
    children: 'Welcome',
    as: 'h1',
    splitBy: 'chars',
    staggerDelay: 0.05,
    variant: 'dramatic',
    triggerOnView: false,
    className: 'text-8xl font-bold text-yellow-400',
  },
  decorators: [
    (Story) => (
      <div className="p-12 bg-neutral-900 min-w-[600px] perspective-[1000px]">
        <Story />
      </div>
    ),
  ],
  parameters: {
    docs: {
      description: {
        story: 'Dramatic variant adds rotation for a more impactful reveal effect.',
      },
    },
  },
};

export const ScrollTriggered: Story = {
  name: 'Scroll Triggered',
  args: {
    children: 'Scroll down to see this animate',
    as: 'h2',
    splitBy: 'words',
    staggerDelay: 0.1,
    variant: 'default',
    triggerOnView: true,
    viewportAmount: 0.5,
    className: 'text-4xl font-bold text-white',
  },
  decorators: [
    (Story) => (
      <div className="bg-neutral-900">
        <div className="h-[80vh] flex items-center justify-center">
          <p className="text-white text-xl">Scroll down â†“</p>
        </div>
        <div className="h-screen flex items-center justify-center">
          <Story />
        </div>
        <div className="h-[50vh]" />
      </div>
    ),
  ],
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        story: 'Animation triggers when the element scrolls into view.',
      },
    },
  },
};

export const Comparison: Story = {
  name: 'Split Mode Comparison',
  render: () => (
    <div className="p-8 bg-neutral-900 space-y-12 min-w-[600px]">
      <div>
        <p className="text-neutral-500 text-sm mb-2">splitBy="chars"</p>
        <KineticText
          as="h2"
          splitBy="chars"
          staggerDelay={0.02}
          triggerOnView={false}
          className="text-3xl font-bold text-white"
        >
          Character Split
        </KineticText>
      </div>
      <div>
        <p className="text-neutral-500 text-sm mb-2">splitBy="words"</p>
        <KineticText
          as="h2"
          splitBy="words"
          staggerDelay={0.1}
          triggerOnView={false}
          className="text-3xl font-bold text-white"
        >
          Word by Word Split
        </KineticText>
      </div>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: 'Comparison of different split modes.',
      },
    },
  },
};
```
  </action>
  <verify>
`npm run storybook` - KineticText stories visible under Components category
All stories render correctly with animations
Controls work to adjust stagger delay and split mode
  </verify>
  <done>
KineticText stories created with all split modes
Interactive controls for staggerDelay, splitBy, variant
Scroll-triggered story demonstrates whileInView
  </done>
</task>

</tasks>

<verification>
1. `npm run ts:check:types` - no TypeScript errors
2. `npm run build` - production build succeeds
3. `npm run dev` - custom cursor visible on desktop
4. `npm run storybook` - both story files render
   - Effects/CustomCursor - interactive cursor demo
   - Components/KineticText - character/word animations
5. Manual test:
   - Desktop browser: custom cursor follows mouse
   - Touch device simulation: native cursor only
   - Click elements: all clicks work normally
</verification>

<success_criteria>
- CursorProvider integrated in App.tsx
- Custom cursor visible on desktop, not on touch
- CustomCursor stories in src/stories/cursor/
- KineticText stories in src/stories/
- All stories have interactive controls
- Build and Storybook both succeed
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-transitions/08-04-SUMMARY.md`
</output>
