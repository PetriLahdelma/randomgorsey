---
phase: 08-page-transitions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/lib/motion/AnimatedRoutes.tsx
autonomous: true

must_haves:
  truths:
    - "User sees exit animation (fade out, slight upward motion) when leaving a page"
    - "User sees enter animation (fade in, downward motion) when arriving at a page"
    - "Navigation waits for exit animation to complete before showing new page"
    - "Scroll position resets to top after exit animation completes"
  artifacts:
    - path: "src/lib/motion/AnimatedRoutes.tsx"
      provides: "AnimatePresence wrapper for route transitions"
      exports: ["AnimatedRoutes"]
    - path: "src/App.tsx"
      provides: "Updated app shell using AnimatedRoutes"
      contains: "AnimatedRoutes"
  key_links:
    - from: "src/lib/motion/AnimatedRoutes.tsx"
      to: "framer-motion AnimatePresence"
      via: "mode='wait' with location key"
      pattern: "AnimatePresence.*mode.*wait"
    - from: "src/App.tsx"
      to: "src/lib/motion/AnimatedRoutes.tsx"
      via: "import and render"
      pattern: "AnimatedRoutes"
---

<objective>
Wire AnimatePresence around Routes to enable coordinated page exit/enter animations.

Purpose: Currently pages only animate on enter. This plan enables exit animations so pages fade out before the new page fades in, creating a polished transition experience.

Output: AnimatedRoutes component wrapping Routes with AnimatePresence, integrated into App.tsx
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-transitions/08-RESEARCH.md

# Existing motion infrastructure
@src/lib/motion/index.ts
@src/lib/motion/variants.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedRoutes component</name>
  <files>src/lib/motion/AnimatedRoutes.tsx</files>
  <action>
Create AnimatedRoutes component that:
1. Uses useLocation() to get current location
2. Wraps Routes in AnimatePresence with mode="wait"
3. Passes location={location} to Routes and key={location.pathname}
4. Uses onExitComplete callback to scroll to top (window.scrollTo(0, 0))
5. Accepts children prop for route definitions

Pattern from research:
```tsx
import { AnimatePresence } from 'framer-motion';
import { Routes, useLocation } from 'react-router-dom';

interface AnimatedRoutesProps {
  children: React.ReactNode;
}

export function AnimatedRoutes({ children }: AnimatedRoutesProps) {
  const location = useLocation();

  return (
    <AnimatePresence
      mode="wait"
      onExitComplete={() => window.scrollTo(0, 0)}
    >
      <Routes location={location} key={location.pathname}>
        {children}
      </Routes>
    </AnimatePresence>
  );
}
```

Export from index.ts barrel file.
  </action>
  <verify>
TypeScript compiles: `npm run ts:check:types`
File exists with correct exports
  </verify>
  <done>
AnimatedRoutes component exists at src/lib/motion/AnimatedRoutes.tsx
Exported from src/lib/motion/index.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Update App.tsx to use AnimatedRoutes</name>
  <files>src/App.tsx</files>
  <action>
Update App.tsx to use AnimatedRoutes instead of bare Routes:

1. Import AnimatedRoutes from '@/lib/motion'
2. Replace `<Routes>...</Routes>` with `<AnimatedRoutes>...</AnimatedRoutes>`
3. Keep Route children exactly as they are (Home, Listen, About, etc.)
4. Remove the ScrollToTop component (onExitComplete handles scroll now)
5. Keep the Suspense wrapper around AnimatedRoutes for lazy loading

The key change is:
- Before: `<Routes><Route path="/" element={<Home />} />...</Routes>`
- After: `<AnimatedRoutes><Route path="/" element={<Home />} />...</AnimatedRoutes>`

Do NOT change:
- AnimationProvider wrapping
- Header/Footer placement
- Lazy imports
- CookieConsent
  </action>
  <verify>
`npm run build` succeeds
`npm run dev` starts and page transitions have visible exit animation
  </verify>
  <done>
App.tsx uses AnimatedRoutes component
ScrollToTop component removed (scroll handled by onExitComplete)
Pages animate out before new page animates in
  </done>
</task>

<task type="auto">
  <name>Task 3: Add exit variant to all page components</name>
  <files>src/pages/Home.tsx, src/pages/About.tsx, src/pages/Contact.tsx, src/pages/Discography.tsx, src/pages/Gallery.tsx, src/pages/Listen.tsx, src/pages/NotFound.tsx</files>
  <action>
Each page component currently has:
```tsx
<motion.div
  variants={pageVariants}
  initial="initial"
  animate="enter"
>
```

Add exit="exit" prop to enable exit animations:
```tsx
<motion.div
  variants={pageVariants}
  initial="initial"
  animate="enter"
  exit="exit"
>
```

The pageVariants already define exit state in variants.ts:
```ts
exit: {
  opacity: 0,
  y: -10,
  transition: { duration: durations.fast },
}
```

Update all 7 page components:
- Home.tsx
- About.tsx
- Contact.tsx
- Discography.tsx
- Gallery.tsx
- Listen.tsx
- NotFound.tsx

Find the motion.div or motion.main with pageVariants and add exit="exit".
  </action>
  <verify>
`npm run build` succeeds
Navigate between pages in browser - exit animation plays (content fades and slides up slightly)
  </verify>
  <done>
All 7 page components have exit="exit" on their pageVariants motion element
Exit animations visible when navigating between pages
  </done>
</task>

</tasks>

<verification>
1. `npm run ts:check:types` - no TypeScript errors
2. `npm run build` - production build succeeds
3. Manual test in browser:
   - Navigate from Home to About - Home fades out, About fades in
   - Navigate from About to Contact - About fades out, Contact fades in
   - Use browser back button - transition plays in reverse
   - Scroll down on a page, navigate away - new page starts at top
</verification>

<success_criteria>
- AnimatedRoutes component exists and is used in App.tsx
- All 7 pages have exit="exit" prop on motion wrapper
- Page transitions show visible exit animation before enter animation
- Scroll position resets to top after exit animation completes
- No console errors during transitions
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-transitions/08-01-SUMMARY.md`
</output>
