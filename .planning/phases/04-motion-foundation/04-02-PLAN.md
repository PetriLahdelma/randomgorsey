---
phase: 04-motion-foundation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/lib/motion/AnimationProvider.tsx
  - src/lib/motion/index.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User with prefers-reduced-motion enabled sees reduced/no transform animations"
    - "User without reduced-motion preference sees full animations"
    - "Developer can wrap app in AnimationProvider for global motion config"
  artifacts:
    - path: "src/lib/motion/AnimationProvider.tsx"
      provides: "MotionConfig + LazyMotion wrapper component"
      exports: ["AnimationProvider"]
    - path: "src/App.tsx"
      provides: "App wrapped in AnimationProvider"
      contains: "AnimationProvider"
  key_links:
    - from: "src/App.tsx"
      to: "src/lib/motion/AnimationProvider.tsx"
      via: "import and JSX wrapper"
      pattern: "import.*AnimationProvider.*from.*motion"
    - from: "src/lib/motion/AnimationProvider.tsx"
      to: "framer-motion"
      via: "MotionConfig reducedMotion"
      pattern: "MotionConfig.*reducedMotion"
---

<objective>
Create AnimationProvider component with accessibility-first reduced-motion handling and integrate into App.tsx.

Purpose: Enable site-wide motion preference detection via Framer Motion's built-in MotionConfig, replacing device-specific animation disabling (isIOS pattern).
Output: AnimationProvider.tsx wrapping the entire app, automatically handling prefers-reduced-motion.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-motion-foundation/04-RESEARCH.md
@src/App.tsx

Key research findings:
- MotionConfig with `reducedMotion="user"` automatically detects prefers-reduced-motion
- When reduced motion is enabled, transform animations (x, y, scale, rotate) are disabled
- Opacity and color animations are preserved for visual feedback
- LazyMotion with domAnimation reduces bundle size by loading features on demand
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimationProvider component</name>
  <files>src/lib/motion/AnimationProvider.tsx</files>
  <action>
Create `src/lib/motion/AnimationProvider.tsx`:

```typescript
import React from 'react';
import { LazyMotion, domAnimation, MotionConfig } from 'framer-motion';

interface AnimationProviderProps {
  children: React.ReactNode;
  /** Override system preference: 'user' (default), 'always', 'never' */
  reducedMotion?: 'user' | 'always' | 'never';
}

/**
 * Provides global animation configuration for the entire app.
 *
 * Features:
 * - Automatic prefers-reduced-motion detection when reducedMotion="user"
 * - LazyMotion for bundle optimization (loads animation features on demand)
 *
 * When reduced motion is enabled:
 * - Transform animations (x, y, scale, rotate) are disabled
 * - Layout animations are disabled
 * - Opacity and color animations are preserved
 */
export const AnimationProvider: React.FC<AnimationProviderProps> = ({
  children,
  reducedMotion = 'user',
}) => {
  return (
    <LazyMotion features={domAnimation} strict>
      <MotionConfig reducedMotion={reducedMotion}>
        {children}
      </MotionConfig>
    </LazyMotion>
  );
};

export default AnimationProvider;
```

Key implementation notes:
- Use `domAnimation` (not `domMax`) - gestures/drag not needed yet
- Use `strict` prop on LazyMotion for development warnings
- Default `reducedMotion="user"` respects system preference
- Export both named and default for flexibility
  </action>
  <verify>File exists: `test -f src/lib/motion/AnimationProvider.tsx && echo "exists"`</verify>
  <done>AnimationProvider.tsx exports component with MotionConfig and LazyMotion</done>
</task>

<task type="auto">
  <name>Task 2: Update motion index with AnimationProvider export</name>
  <files>src/lib/motion/index.ts</files>
  <action>
Update `src/lib/motion/index.ts` to export AnimationProvider:

Add after existing exports:

```typescript
// Provider
export { AnimationProvider } from './AnimationProvider';
```

The full index.ts should now export:
- Configuration: springs, durations, eases
- Types: SpringPreset, DurationPreset, EasePreset
- Variants: pageVariants, fadeVariants, staggerContainer, staggerItem, overlayVariants, modalVariants
- Provider: AnimationProvider
- Framer Motion utilities: motion, AnimatePresence, useReducedMotion, useAnimation, useInView
  </action>
  <verify>Export present: `grep "AnimationProvider" src/lib/motion/index.ts`</verify>
  <done>index.ts exports AnimationProvider alongside other motion utilities</done>
</task>

<task type="auto">
  <name>Task 3: Wrap App.tsx with AnimationProvider</name>
  <files>src/App.tsx</files>
  <action>
Update `src/App.tsx` to wrap the app in AnimationProvider:

1. **Add import**:
   ```typescript
   import { AnimationProvider } from '@/lib/motion';
   ```

2. **Wrap BrowserRouter** with AnimationProvider:
   ```typescript
   return (
     <AnimationProvider>
       <BrowserRouter>
         {/* existing content unchanged */}
       </BrowserRouter>
     </AnimationProvider>
   );
   ```

The AnimationProvider should be the outermost wrapper (outside BrowserRouter) so all route components inherit the motion configuration.

Do NOT change any other code in App.tsx - the existing structure, routes, and state management remain unchanged.
  </action>
  <verify>Import and usage present: `grep -E "(AnimationProvider|@/lib/motion)" src/App.tsx`</verify>
  <done>App.tsx wraps entire app in AnimationProvider with reducedMotion="user" (default)</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build 2>&1 | grep -i error || echo "Build passed"`
2. AnimationProvider in tree: `grep -A2 "AnimationProvider" src/App.tsx`
3. Test reduced motion:
   - Open Chrome DevTools > Rendering > Emulate CSS media feature prefers-reduced-motion
   - Set to "reduce" - transform animations should be suppressed
   - Set to "no-preference" - full animations should play
</verification>

<success_criteria>
- AnimationProvider.tsx exists with MotionConfig reducedMotion="user"
- App.tsx imports and wraps with AnimationProvider
- Build compiles without errors
- Reduced motion preference is respected at runtime
</success_criteria>

<output>
After completion, create `.planning/phases/04-motion-foundation/04-02-SUMMARY.md`
</output>
