---
phase: 04-motion-foundation
plan: 04
type: execute
wave: 3
depends_on: ["04-01"]
files_modified:
  - src/components/Modal.tsx
autonomous: true

must_haves:
  truths:
    - "Modal backdrop uses overlayVariants from centralized motion config"
    - "Modal content uses modalVariants from centralized motion config"
    - "Modal animations are consistent with site-wide motion system"
  artifacts:
    - path: "src/components/Modal.tsx"
      provides: "Modal component with centralized motion variants"
      contains: "overlayVariants"
  key_links:
    - from: "src/components/Modal.tsx"
      to: "@/lib/motion"
      via: "import { motion, AnimatePresence, overlayVariants, modalVariants }"
      pattern: "import.*overlayVariants.*modalVariants.*from.*@/lib/motion"
---

<objective>
Migrate Modal component from inline animation configs to centralized overlayVariants and modalVariants.

Purpose: Ensure modal animations are consistent with the site-wide motion system and benefit from centralized reduced-motion handling.
Output: Modal.tsx uses variants from @/lib/motion instead of inline animation objects.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-motion-foundation/04-RESEARCH.md
@.planning/phases/04-motion-foundation/04-01-SUMMARY.md
@src/components/Modal.tsx

Current Modal pattern:
```typescript
import { motion, AnimatePresence } from 'framer-motion'

<motion.div
  initial={{ opacity: 0 }}
  animate={{ opacity: 1 }}
  exit={{ opacity: 0 }}
  transition={{ duration: 0.2 }}
>
  <motion.div
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    exit={{ opacity: 0, scale: 0.95 }}
    transition={{ duration: 0.2, ease: 'easeOut' }}
  >
```

Target pattern using centralized variants:
```typescript
import { motion, AnimatePresence, overlayVariants, modalVariants } from '@/lib/motion'

<motion.div variants={overlayVariants} initial="initial" animate="enter" exit="exit">
  <motion.div variants={modalVariants} initial="initial" animate="enter" exit="exit">
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Modal to use centralized variants</name>
  <files>src/components/Modal.tsx</files>
  <action>
Update `src/components/Modal.tsx`:

1. **Update import** from framer-motion to @/lib/motion:
   ```typescript
   import { motion, AnimatePresence, overlayVariants, modalVariants } from '@/lib/motion'
   ```

2. **Update backdrop motion.div** (the overlay):
   Replace:
   ```typescript
   <motion.div
     initial={{ opacity: 0 }}
     animate={{ opacity: 1 }}
     exit={{ opacity: 0 }}
     transition={{ duration: 0.2 }}
   ```
   With:
   ```typescript
   <motion.div
     variants={overlayVariants}
     initial="initial"
     animate="enter"
     exit="exit"
   ```

3. **Update modal content motion.div**:
   Replace:
   ```typescript
   <motion.div
     initial={{ opacity: 0, scale: 0.95 }}
     animate={{ opacity: 1, scale: 1 }}
     exit={{ opacity: 0, scale: 0.95 }}
     transition={{ duration: 0.2, ease: 'easeOut' }}
   ```
   With:
   ```typescript
   <motion.div
     variants={modalVariants}
     initial="initial"
     animate="enter"
     exit="exit"
   ```

4. **Preserve all other props**: Keep role, aria-*, onClick, className, data-testid attributes unchanged.

The variants handle all timing via springs.snappy and durations.fast from config.ts.
  </action>
  <verify>Variants used: `grep -E "(overlayVariants|modalVariants)" src/components/Modal.tsx`</verify>
  <done>Modal.tsx uses overlayVariants and modalVariants from @/lib/motion</done>
</task>

<task type="auto">
  <name>Task 2: Verify Modal animations work correctly</name>
  <files>None (verification only)</files>
  <action>
Verification steps:

1. **Run build** to confirm TypeScript compilation:
   ```bash
   npm run build
   ```

2. **Check import path**:
   ```bash
   grep "@/lib/motion" src/components/Modal.tsx
   ```

3. **Verify no inline animation configs remain**:
   ```bash
   grep -E "initial:\s*\{" src/components/Modal.tsx && echo "WARN: Inline animation found" || echo "PASS: Using variants"
   ```

4. **Manual test** (if dev server running):
   - Open any page with Modal usage (Gallery has modal for image viewing)
   - Open modal - should animate in with spring physics (snappy)
   - Close modal - should animate out with fade
   - Test with prefers-reduced-motion enabled - scale animation should be suppressed

Note: The modalVariants use springs.snappy for a responsive, quality feel. This is slightly different from the original duration-based animation but provides better physics.
  </action>
  <verify>Build passes: `npm run build 2>&1 | grep -i error || echo "Build passed"`</verify>
  <done>Modal animations verified working with centralized variants</done>
</task>

</tasks>

<verification>
1. Build: `npm run build 2>&1 | grep -i error || echo "Build passed"`
2. Import correct: `grep "@/lib/motion" src/components/Modal.tsx`
3. Variants used: `grep -E "variants=" src/components/Modal.tsx | wc -l` (should be 2)
4. No inline animations: `grep -c "initial: {" src/components/Modal.tsx` (should be 0)
5. Storybook: `npm run storybook` - Modal story should show animations
</verification>

<success_criteria>
- Modal.tsx imports from @/lib/motion
- Backdrop uses overlayVariants
- Content uses modalVariants
- No inline animation objects remain
- Build compiles without errors
- Modal open/close animations work in browser
</success_criteria>

<output>
After completion, create `.planning/phases/04-motion-foundation/04-04-SUMMARY.md`
</output>
