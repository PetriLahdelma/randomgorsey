---
phase: 03-typography-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/globals.css
  - src/styles/tokens/typography.css
  - index.html
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User experiences no FOIT (Flash of Invisible Text) on initial page load"
    - "User sees smooth font swap with system fallback appearing first"
    - "User sees typography scale fluidly between mobile and desktop"
  artifacts:
    - path: "src/styles/tokens/typography.css"
      provides: "Fluid type scale with clamp() values"
      exports: ["--text-xs", "--text-sm", "--text-base", "--text-lg", "--text-xl", "--text-2xl", "--text-3xl", "--text-4xl", "--text-5xl", "--text-6xl"]
    - path: "src/styles/globals.css"
      provides: "Optimized @font-face declarations with font-display: swap"
      contains: "font-display: swap"
    - path: "index.html"
      provides: "Font preloading for critical fonts"
      contains: "rel=\"preload\""
  key_links:
    - from: "src/styles/globals.css"
      to: "src/styles/tokens/typography.css"
      via: "@import statement"
      pattern: "@import.*typography\\.css"
    - from: "src/styles/tokens/typography.css"
      to: "@theme directive"
      via: "Tailwind theme registration"
      pattern: "@theme"
---

<objective>
Establish fluid typography token infrastructure with optimized font loading

Purpose: Create the foundation for fluid typography by defining a clamp()-based type scale in tokens, consolidating Europa font weights under a single font-family, adding font-display: swap to prevent FOIT, and preloading critical fonts in index.html.

Output: typography.css token file, updated @font-face declarations in globals.css, font preload links in index.html
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-typography-system/03-RESEARCH.md

# Existing token architecture
@src/styles/globals.css
@src/styles/tokens/primitives.css

# Current font files
# Located at src/fonts/: europa-bold-webfont.woff2, europa-regular-webfont.woff2, europa-light-webfont.woff2, Tschick-Bold.woff2
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create typography.css with fluid type scale</name>
  <files>src/styles/tokens/typography.css</files>
  <action>
Create a new typography token file that defines a fluid type scale using clamp() values.

Use a 1.25 (major third) scale ratio for harmonious progression. Each step should scale between 400px and 1280px viewport.

Define the following tokens in a @theme block:
- --text-xs: clamp(0.64rem, 0.6rem + 0.2vw, 0.8rem) with --text-xs--line-height: 1.4
- --text-sm: clamp(0.8rem, 0.75rem + 0.25vw, 1rem) with --text-sm--line-height: 1.5
- --text-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem) with --text-base--line-height: 1.6
- --text-lg: clamp(1.125rem, 1.05rem + 0.375vw, 1.35rem) with --text-lg--line-height: 1.5
- --text-xl: clamp(1.266rem, 1.15rem + 0.58vw, 1.62rem) with --text-xl--line-height: 1.4
- --text-2xl: clamp(1.424rem, 1.27rem + 0.77vw, 1.944rem) with --text-2xl--line-height: 1.35
- --text-3xl: clamp(1.602rem, 1.4rem + 1.01vw, 2.333rem) with --text-3xl--line-height: 1.25
- --text-4xl: clamp(1.802rem, 1.54rem + 1.31vw, 2.8rem) with --text-4xl--line-height: 1.2
- --text-5xl: clamp(2.027rem, 1.69rem + 1.69vw, 3.36rem) with --text-5xl--line-height: 1.1
- --text-6xl: clamp(2.281rem, 1.85rem + 2.16vw, 4.032rem) with --text-6xl--line-height: 1.05

Also add letter-spacing tokens:
- --text-xs--letter-spacing: 0.02em
- --text-eyebrow--letter-spacing: 0.25em (for uppercase eyebrow text)

Include a header comment explaining the three-layer integration and the 1.25 scale ratio.

DO NOT override default Tailwind text-* utilities yet - let them coexist. The typography tokens will be used explicitly via var() or custom utility classes.
  </action>
  <verify>
File exists at src/styles/tokens/typography.css.
File contains @theme block with all 10 size tokens (xs through 6xl).
Each size has corresponding --line-height token.
  </verify>
  <done>
typography.css contains complete fluid type scale with clamp() values, line-heights, and letter-spacing tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Optimize @font-face declarations and integrate typography tokens</name>
  <files>src/styles/globals.css</files>
  <action>
Update globals.css with the following changes:

1. Add import for typography.css after sections.css:
   @import "./tokens/typography.css";

2. Consolidate Europa weights under single font-family name with weight axis:
   - Keep "Europa Bold", "Europa Regular", "Europa Light" as separate font-family names (required for current font files which are static, not variable)
   - BUT add a unified "Europa" font-family that maps to the same files with explicit font-weight declarations

3. Add font-display: swap to ALL @font-face declarations to prevent FOIT:
   - "Europa Bold" - add font-display: swap; font-weight: 700;
   - "Europa Regular" - add font-display: swap; font-weight: 400;
   - "Europa Light" - add font-display: swap; font-weight: 300;
   - "Tschick Bold" - add font-display: swap; font-weight: 700;

4. Add three additional @font-face declarations that create a unified "Europa" family:
   @font-face {
     font-family: "Europa";
     font-weight: 300;
     font-style: normal;
     font-display: swap;
     src: url("../fonts/europa-light-webfont.woff2") format("woff2"),
          url("../fonts/europa-light-webfont.woff") format("woff");
   }
   (Repeat for 400 and 700 weights)

5. Update primitives.css references in the same commit:
   - Add --font-family-europa-unified: "Europa", ui-sans-serif, system-ui, sans-serif; to primitives.css

Keep the existing individual font-family declarations for backwards compatibility with current components.

Order the @font-face declarations: Europa (unified), Europa Bold, Europa Regular, Europa Light, Tschick Bold.
  </action>
  <verify>
All @font-face declarations include font-display: swap.
Unified "Europa" font-family declarations exist for weights 300, 400, 700.
Typography.css is imported in globals.css.
Run: npm run build - should complete without errors.
  </verify>
  <done>
@font-face declarations optimized with font-display: swap, unified Europa family created, typography.css integrated into import chain.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add font preloading in index.html</name>
  <files>index.html</files>
  <action>
Add preload links for the two most critical fonts in the head section, before the title tag:

1. Europa Regular (body text - most common):
   <link rel="preload" href="/src/fonts/europa-regular-webfont.woff2" as="font" type="font/woff2" crossorigin>

2. Tschick Bold (headings - above fold):
   <link rel="preload" href="/src/fonts/Tschick-Bold.woff2" as="font" type="font/woff2" crossorigin>

Add a comment explaining the preload strategy:
<!-- Preload critical fonts to reduce FOIT/FOUT -->

Do NOT preload Europa Bold or Light - they are less critical and preloading too many fonts hurts performance.

Place the preload links after the meta tags but before the apple-touch-icon link.
  </action>
  <verify>
index.html contains two preload links for woff2 fonts.
Both have crossorigin attribute (required for fonts).
Run: npm run build - should complete without errors.
Run: npm run dev - inspect Network tab to verify fonts load with preload priority.
  </verify>
  <done>
Critical fonts (Europa Regular, Tschick Bold) are preloaded in index.html, reducing time to first contentful paint with correct typography.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build verification:
   ```bash
   npm run build
   ```
   Should complete without errors.

2. Typography tokens exist:
   ```bash
   grep -c "text-6xl" src/styles/tokens/typography.css
   ```
   Should return 1 or more.

3. Font-display swap present:
   ```bash
   grep -c "font-display: swap" src/styles/globals.css
   ```
   Should return at least 7 (4 original fonts + 3 unified Europa).

4. Font preload present:
   ```bash
   grep -c "rel=\"preload\"" index.html
   ```
   Should return 2.

5. Visual verification:
   - Run npm run dev
   - Open in browser with Network tab
   - Verify fonts load early with "preload" initiator
   - Disable cache and reload - text should appear quickly with fallback then swap
</verification>

<success_criteria>
1. typography.css exists with fluid clamp()-based type scale (10 sizes: xs through 6xl)
2. All @font-face declarations include font-display: swap
3. Unified "Europa" font-family exists with weight axis (300, 400, 700)
4. Critical fonts preloaded in index.html
5. Build passes without errors
6. No visible FOIT on page load (text appears immediately with fallback)
</success_criteria>

<output>
After completion, create `.planning/phases/03-typography-system/03-01-SUMMARY.md`
</output>
